<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barbershop Terminbuchung</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&family=Open+Sans:wght@300;400;500;600;700&family=Squada+One&family=Oswald:wght@300;400;500;600;700&family=Bebas+Neue&family=Anton&display=swap');
        body { font-family: var(--text-font, 'Inter'), sans-serif; }
        h1, h2, h3, .title-font { font-family: var(--title-font, 'Squada One'), cursive; font-size: 1.2em; }
        h1 { font-size: 2.5rem; }
        h2 { font-size: 1.8rem; }
        h3 { font-size: 1.4rem; }
        .gradient-bg { background: linear-gradient(135deg, var(--primary-color, #2563eb) 0%, var(--secondary-color, #1e40af) 100%); }
        .glass-effect { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.1); }
        .booking-card { transition: all 0.3s ease; }
        .booking-card:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .logo-container { width: 80px; height: 80px; border-radius: 50%; overflow: hidden; margin: 0 auto 1rem; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; }
        .logo-container img { width: 100%; height: 100%; object-fit: cover; }
        .whatsapp-btn { background: #25D366; color: white; }
        .whatsapp-btn:hover { background: #128C7E; }
        .design-panel { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; }
        .design-panel.open { max-height: 80vh; overflow-y: auto; }
        .design-panel::-webkit-scrollbar { width: 8px; }
        .design-panel::-webkit-scrollbar-track { background: rgba(255,255,255,0.1); border-radius: 4px; }
        .design-panel::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 4px; }
        .design-panel::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.5); }
        .draggable-service { cursor: move; transition: all 0.3s ease; }
        .draggable-service:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .draggable-service.dragging { opacity: 0.5; transform: rotate(5deg); }
        .drop-zone { border: 2px dashed rgba(255,255,255,0.3); border-radius: 8px; padding: 20px; margin: 10px 0; transition: all 0.3s ease; }
        .drop-zone.drag-over { border-color: #10b981; background: rgba(16, 185, 129, 0.1); }
        .category-container { border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 15px; margin: 10px 0; }
        .service-item { background: rgba(255,255,255,0.05); border-radius: 6px; padding: 10px; margin: 5px 0; }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <div id="logoContainer" class="logo-container">
                <span class="text-3xl">✂️</span>
            </div>
            <h1 class="text-4xl font-bold text-white mb-2" id="businessName">Barbershop Elite</h1>
            <p class="text-white/80 text-lg">Professionelle Herrenfriseur-Services</p>
        </div>

        <!-- Main Content -->
        <div class="max-w-4xl mx-auto">
            <!-- Booking Form -->
            <div id="bookingForm" class="glass-effect rounded-2xl p-8 mb-8">
                <h2 class="text-2xl font-semibold text-white mb-6">🗓️ Termin buchen</h2>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Service Selection -->
                    <div>
                        <label class="block text-white font-medium mb-3">Service wählen</label>
                        <div id="servicesList" class="space-y-3">
                            <!-- Services will be loaded here -->
                        </div>
                    </div>

                    <!-- Date & Time Selection -->
                    <div>
                        <label class="block text-white font-medium mb-3">Datum & Uhrzeit</label>
                        <div class="space-y-4">
                            <input type="date" id="bookingDate" class="w-full p-3 rounded-lg bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                            
                            <div id="timeSlots" class="grid grid-cols-3 gap-2">
                                <!-- Time slots will be generated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Customer Info -->
                <div class="mt-6 grid md:grid-cols-2 gap-4">
                    <input type="text" id="customerName" placeholder="Ihr Name" class="p-3 rounded-lg bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                    <input type="tel" id="customerPhone" placeholder="Telefonnummer" class="p-3 rounded-lg bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                </div>

                <!-- Booking Summary -->
                <div id="bookingSummary" class="mt-6 bg-white/10 rounded-lg p-4 hidden">
                    <h3 class="text-white font-medium mb-2">Buchungsübersicht</h3>
                    <div id="summaryContent" class="text-white/80 text-sm"></div>
                </div>

                <!-- Book Button -->
                <button id="bookButton" class="w-full mt-6 bg-white text-purple-600 font-semibold py-3 px-6 rounded-lg hover:bg-white/90 transition-all disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    Termin buchen
                </button>
            </div>

            <!-- Admin Panel Toggle -->
            <div class="text-center mb-4">
                <button id="adminToggle" class="text-white/70 hover:text-white text-sm bg-white/10 px-4 py-2 rounded-lg hover:bg-white/20 transition-all">
                    🔧 Admin-Bereich
                </button>
            </div>



            <!-- Admin Panel -->
            <div id="adminPanel" class="glass-effect rounded-2xl p-8 hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">👨‍💼 Admin-Bereich</h2>
                    <div class="space-x-2">
                        <button id="serviceToggle" class="text-white/70 hover:text-white text-sm bg-white/10 px-3 py-1 rounded">
                            ⚙️ Services
                        </button>
                        <button id="designToggle" class="text-white/70 hover:text-white text-sm bg-white/10 px-3 py-1 rounded">
                            🎨 Design
                        </button>
                        <button id="whatsappToggle" class="text-white/70 hover:text-white text-sm bg-white/10 px-3 py-1 rounded">
                            📱 WhatsApp
                        </button>
                        <button id="hoursToggle" class="text-white/70 hover:text-white text-sm bg-white/10 px-3 py-1 rounded">
                            🕒 Arbeitszeiten
                        </button>
                        <button id="textToggle" class="text-white/70 hover:text-white text-sm bg-white/10 px-3 py-1 rounded">
                            📝 Texte
                        </button>
                        <button id="logoutButton" class="text-white/70 hover:text-white text-sm bg-white/10 px-3 py-1 rounded">
                            🚪 Abmelden
                        </button>
                    </div>
                </div>

                <!-- Service Management Panel -->
                <div id="servicePanel" class="bg-white/5 rounded-xl p-6 mb-6 design-panel">
                    <h3 class="text-xl font-semibold text-white mb-4">⚙️ Services verwalten & organisieren</h3>
                    
                    <!-- View Toggle -->
                    <div class="mb-6 flex gap-2">
                        <button id="viewEditMode" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700 transition-all">
                            ✏️ Bearbeiten
                        </button>
                        <button id="viewOrganizeMode" class="bg-purple-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-purple-700 transition-all">
                            🔄 Organisieren (Drag & Drop)
                        </button>
                    </div>

                    <!-- Edit Mode -->
                    <div id="editModeContent">
                        <!-- Create New Category -->
                        <div class="bg-blue-500/20 rounded-lg p-4 mb-6">
                            <h4 class="text-white font-medium mb-3">🏗️ Neue Kategorie erstellen</h4>
                            <div class="grid md:grid-cols-3 gap-3 mb-3">
                                <input type="text" id="newCategoryName" placeholder="Kategorie Name (z.B. Haarschnitte)" class="p-3 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                <input type="text" id="newCategoryEmoji" placeholder="Emoji (z.B. ✂️)" class="p-3 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                <button id="createCategoryBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg font-medium transition-all">
                                    🏗️ Kategorie erstellen
                                </button>
                            </div>
                            
                            <!-- Create Subcategory -->
                            <div class="border-t border-white/10 pt-3">
                                <h5 class="text-white/80 font-medium mb-2">📋 Unterkategorie hinzufügen</h5>
                                <div class="grid md:grid-cols-3 gap-3">
                                    <select id="selectCategoryForSub" class="p-3 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                        <option value="">Kategorie wählen</option>
                                    </select>
                                    <input type="text" id="newSubcategoryName" placeholder="Unterkategorie Name (z.B. Klassisch)" class="p-3 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                    <button id="createSubcategoryBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-3 rounded-lg font-medium transition-all">
                                        📋 Unterkategorie hinzufügen
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Add New Service -->
                        <div class="bg-white/5 rounded-lg p-4 mb-6">
                            <h4 class="text-white font-medium mb-3">➕ Neuen Service hinzufügen</h4>
                            <div class="grid md:grid-cols-2 gap-3">
                                <input type="text" id="newServiceName" placeholder="Service Name" class="p-3 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                <input type="text" id="newServiceDescription" placeholder="Beschreibung" class="p-3 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                            </div>
                            <div class="grid md:grid-cols-4 gap-3 mt-3">
                                <input type="number" id="newServicePrice" placeholder="Preis €" class="p-3 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                <input type="number" id="newServiceDuration" placeholder="Dauer Min" class="p-3 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                <input type="text" id="newServiceEmoji" placeholder="Emoji (z.B. ✂️)" class="p-3 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                <select id="newServiceCategory" class="p-3 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                    <option value="">Kategorie wählen</option>
                                    <option value="simple">Einfacher Service</option>
                                </select>
                            </div>
                            <div class="grid md:grid-cols-2 gap-3 mt-3" id="subcategorySelection" style="display: none;">
                                <select id="newServiceSubcategory" class="p-3 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                    <option value="">Unterkategorie wählen</option>
                                </select>
                            </div>
                            <div class="mt-4">
                                <button id="addServiceBtn" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-all">
                                    ➕ Service hinzufügen
                                </button>
                            </div>
                        </div>

                        <!-- Individual Service Editing -->
                        <div id="serviceEditingSections" class="space-y-4">
                            <!-- Service editing sections will be loaded here -->
                        </div>
                    </div>

                    <!-- Organize Mode -->
                    <div id="organizeModeContent" class="hidden">
                        <div class="bg-blue-500/20 rounded-lg p-4 mb-6">
                            <h4 class="text-white font-medium mb-2">🔄 Services per Drag & Drop organisieren</h4>
                            <p class="text-white/80 text-sm mb-2">
                                Ziehen Sie Services zwischen Kategorien um sie zu verschieben:
                            </p>
                            <ul class="text-white/70 text-sm space-y-1 ml-4">
                                <li>• Services innerhalb einer Kategorie verschieben</li>
                                <li>• Services zwischen Kategorien verschieben</li>
                                <li>• Neue Kategorien werden automatisch erstellt</li>
                            </ul>
                        </div>

                        <div id="dragDropServiceContainer">
                            <!-- Drag & Drop interface will be loaded here -->
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="mt-6 flex gap-4 flex-wrap">
                        <button id="saveAllServices" class="bg-white text-purple-600 font-semibold py-2 px-6 rounded-lg hover:bg-white/90 transition-all">
                            💾 Alle Services speichern
                        </button>
                        <button id="previewAllServices" class="bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-blue-700 transition-all">
                            👁️ Alle Änderungen vorschauen
                        </button>
                        <button id="resetAllServices" class="bg-red-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-red-700 transition-all">
                            🔄 Alle Services zurücksetzen
                        </button>
                    </div>
                </div>

                <!-- Design Panel -->
                <div id="designPanel" class="bg-white/5 rounded-xl p-6 mb-6 design-panel">
                    <h3 class="text-xl font-semibold text-white mb-4">🎨 Design & Texte bearbeiten</h3>
                    
                    <div class="space-y-6">
                        <!-- Logo & Business Name Section -->
                        <div class="bg-white/5 rounded-lg p-4">
                            <h4 class="text-white font-medium mb-4">🏪 Logo & Geschäftsname</h4>
                            <div class="grid md:grid-cols-2 gap-4">
                                <!-- Logo Upload -->
                                <div>
                                    <label class="block text-white/70 text-sm mb-2">Logo hochladen</label>
                                    <input type="file" id="logoUpload" accept="image/*" class="w-full p-2 rounded-lg bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none file:mr-4 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-white file:text-purple-600 hover:file:bg-gray-100">
                                    <p class="text-white/50 text-xs mt-1">JPG, PNG oder GIF (max. 2MB)</p>
                                </div>

                                <!-- Business Name -->
                                <div>
                                    <label class="block text-white/70 text-sm mb-2">Geschäftsname</label>
                                    <input type="text" id="businessNameInput" placeholder="Barbershop Elite" class="w-full p-2 rounded-lg bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                </div>
                            </div>
                        </div>

                        <!-- Main Title Section -->
                        <div class="bg-white/5 rounded-lg p-4">
                            <h4 class="text-white font-medium mb-4">📝 Haupttitel bearbeiten</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-white/70 text-sm mb-1">Titel-Text</label>
                                    <input type="text" id="editMainTitleDesign" placeholder="Barbershop Elite" class="w-full p-2 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Schriftgröße (rem)</label>
                                        <input type="number" id="mainTitleSizeDesign" value="2.5" step="0.1" min="1" max="5" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Schriftart</label>
                                        <select id="mainTitleFontDesign" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                            <option value="Squada One">Squada One</option>
                                            <option value="Oswald">Oswald</option>
                                            <option value="Bebas Neue">Bebas Neue</option>
                                            <option value="Anton">Anton</option>
                                            <option value="Inter">Inter</option>
                                            <option value="Poppins">Poppins</option>
                                        </select>
                                    </div>
                                </div>
                                <button id="applyMainTitle" class="bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700 transition-all">
                                    ✨ Sofort anwenden
                                </button>
                            </div>
                        </div>

                        <!-- Subtitle Section -->
                        <div class="bg-white/5 rounded-lg p-4">
                            <h4 class="text-white font-medium mb-4">📄 Untertitel bearbeiten</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-white/70 text-sm mb-1">Untertitel-Text</label>
                                    <input type="text" id="editSubtitleDesign" placeholder="Professionelle Herrenfriseur-Services" class="w-full p-2 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Schriftgröße (rem)</label>
                                        <input type="number" id="subtitleSizeDesign" value="1.125" step="0.1" min="0.5" max="3" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Schriftart</label>
                                        <select id="subtitleFontDesign" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                            <option value="Inter">Inter</option>
                                            <option value="Poppins">Poppins</option>
                                            <option value="Roboto">Roboto</option>
                                            <option value="Open Sans">Open Sans</option>
                                        </select>
                                    </div>
                                </div>
                                <button id="applySubtitle" class="bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700 transition-all">
                                    ✨ Sofort anwenden
                                </button>
                            </div>
                        </div>

                        <!-- Booking Form Title Section -->
                        <div class="bg-white/5 rounded-lg p-4">
                            <h4 class="text-white font-medium mb-4">🗓️ Buchungsformular Titel</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-white/70 text-sm mb-1">Formular-Titel</label>
                                    <input type="text" id="editBookingTitleDesign" placeholder="🗓️ Termin buchen" class="w-full p-2 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Schriftgröße (rem)</label>
                                        <input type="number" id="bookingTitleSizeDesign" value="1.5" step="0.1" min="0.5" max="3" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Schriftart</label>
                                        <select id="bookingTitleFontDesign" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                            <option value="Inter">Inter</option>
                                            <option value="Poppins">Poppins</option>
                                            <option value="Squada One">Squada One</option>
                                            <option value="Oswald">Oswald</option>
                                        </select>
                                    </div>
                                </div>
                                <button id="applyBookingTitle" class="bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700 transition-all">
                                    ✨ Sofort anwenden
                                </button>
                            </div>
                        </div>

                        <!-- Form Labels Section -->
                        <div class="bg-white/5 rounded-lg p-4">
                            <h4 class="text-white font-medium mb-4">🏷️ Formularlabels bearbeiten</h4>
                            <div class="space-y-3">
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Service-Label</label>
                                        <input type="text" id="editServiceLabelDesign" placeholder="Service wählen" class="w-full p-2 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Datum-Label</label>
                                        <input type="text" id="editDateLabelDesign" placeholder="Datum & Uhrzeit" class="w-full p-2 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Name-Platzhalter</label>
                                        <input type="text" id="editNamePlaceholderDesign" placeholder="Ihr Name" class="w-full p-2 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Telefon-Platzhalter</label>
                                        <input type="text" id="editPhonePlaceholderDesign" placeholder="Telefonnummer" class="w-full p-2 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Label-Schriftgröße (rem)</label>
                                        <input type="number" id="labelSizeDesign" value="1" step="0.1" min="0.5" max="2" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Label-Schriftart</label>
                                        <select id="labelFontDesign" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                            <option value="Inter">Inter</option>
                                            <option value="Poppins">Poppins</option>
                                            <option value="Roboto">Roboto</option>
                                        </select>
                                    </div>
                                </div>
                                <button id="applyLabels" class="bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700 transition-all">
                                    ✨ Sofort anwenden
                                </button>
                            </div>
                        </div>

                        <!-- Button Text Section -->
                        <div class="bg-white/5 rounded-lg p-4">
                            <h4 class="text-white font-medium mb-4">🔘 Button-Text bearbeiten</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-white/70 text-sm mb-1">Button-Text</label>
                                    <input type="text" id="editButtonTextDesign" placeholder="Termin buchen" class="w-full p-2 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Schriftgröße (rem)</label>
                                        <input type="number" id="buttonTextSizeDesign" value="1" step="0.1" min="0.5" max="2" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Schriftart</label>
                                        <select id="buttonTextFontDesign" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                            <option value="Inter">Inter</option>
                                            <option value="Poppins">Poppins</option>
                                            <option value="Roboto">Roboto</option>
                                        </select>
                                    </div>
                                </div>
                                <button id="applyButton" class="bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700 transition-all">
                                    ✨ Sofort anwenden
                                </button>
                            </div>
                        </div>

                        <!-- Colors Section -->
                        <div class="bg-white/5 rounded-lg p-4">
                            <h4 class="text-white font-medium mb-4">🎨 Farben anpassen</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-white/70 text-sm mb-2">Hauptfarbe</label>
                                    <div class="flex gap-2">
                                        <input type="text" id="primaryColorInput" placeholder="#2563eb" class="flex-1 p-2 rounded-lg bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                        <input type="color" id="primaryColorPicker" class="w-10 h-10 rounded border border-white/20 bg-white/10">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-white/70 text-sm mb-2">Zweitfarbe</label>
                                    <div class="flex gap-2">
                                        <input type="text" id="secondaryColorInput" placeholder="#1e40af" class="flex-1 p-2 rounded-lg bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                        <input type="color" id="secondaryColorPicker" class="w-10 h-10 rounded border border-white/20 bg-white/10">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 flex gap-4">
                        <button id="saveDesign" class="bg-white text-purple-600 font-semibold py-2 px-6 rounded-lg hover:bg-white/90 transition-all">
                            💾 Alles speichern
                        </button>
                        <button id="resetDesign" class="bg-white/20 text-white font-semibold py-2 px-6 rounded-lg hover:bg-white/30 transition-all">
                            🔄 Zurücksetzen
                        </button>
                        <button id="previewAllChanges" class="bg-green-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-green-700 transition-all">
                            👁️ Alle Änderungen vorschauen
                        </button>
                    </div>
                </div>

                <!-- Working Hours Panel -->
                <div id="hoursPanel" class="bg-white/5 rounded-xl p-6 mb-6 design-panel">
                    <h3 class="text-xl font-semibold text-white mb-4">🕒 Arbeitszeiten verwalten</h3>
                    
                    <div class="space-y-6">
                        <!-- Days of Week -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="space-y-3">
                                <h4 class="text-white font-medium">Wochentage aktivieren</h4>
                                <div class="space-y-2">
                                    <label class="flex items-center text-white">
                                        <input type="checkbox" id="dayMonday" class="mr-3 w-4 h-4" checked>
                                        Montag
                                    </label>
                                    <label class="flex items-center text-white">
                                        <input type="checkbox" id="dayTuesday" class="mr-3 w-4 h-4" checked>
                                        Dienstag
                                    </label>
                                    <label class="flex items-center text-white">
                                        <input type="checkbox" id="dayWednesday" class="mr-3 w-4 h-4" checked>
                                        Mittwoch
                                    </label>
                                    <label class="flex items-center text-white">
                                        <input type="checkbox" id="dayThursday" class="mr-3 w-4 h-4" checked>
                                        Donnerstag
                                    </label>
                                    <label class="flex items-center text-white">
                                        <input type="checkbox" id="dayFriday" class="mr-3 w-4 h-4" checked>
                                        Freitag
                                    </label>
                                    <label class="flex items-center text-white">
                                        <input type="checkbox" id="daySaturday" class="mr-3 w-4 h-4">
                                        Samstag
                                    </label>
                                    <label class="flex items-center text-white">
                                        <input type="checkbox" id="daySunday" class="mr-3 w-4 h-4">
                                        Sonntag
                                    </label>
                                </div>
                            </div>
                            
                            <div class="space-y-3">
                                <h4 class="text-white font-medium">Arbeitszeiten</h4>
                                <div class="grid grid-cols-2 gap-2">
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Öffnung</label>
                                        <input type="time" id="openTime" value="09:00" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Schließung</label>
                                        <input type="time" id="closeTime" value="18:00" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-2">
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Mittagspause Start</label>
                                        <input type="time" id="breakStart" value="12:00" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Mittagspause Ende</label>
                                        <input type="time" id="breakEnd" value="13:00" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-white/70 text-sm mb-1">Termin-Intervall (Minuten)</label>
                                    <select id="timeInterval" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                        <option value="15">15 Minuten</option>
                                        <option value="30" selected>30 Minuten</option>
                                        <option value="60">60 Minuten</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Custom Time Slots -->
                        <div class="bg-white/5 rounded-lg p-4">
                            <h4 class="text-white font-medium mb-3">Individuelle Zeitslots hinzufügen</h4>
                            <div class="flex gap-2 mb-3">
                                <input type="time" id="customTimeSlot" class="p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                <button id="addTimeSlot" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded transition-all">
                                    ➕ Hinzufügen
                                </button>
                            </div>
                            <div id="customTimeSlots" class="flex flex-wrap gap-2">
                                <!-- Custom time slots will appear here -->
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 flex gap-4">
                        <button id="saveHours" class="bg-white text-purple-600 font-semibold py-2 px-6 rounded-lg hover:bg-white/90 transition-all">
                            💾 Arbeitszeiten speichern
                        </button>
                        <button id="resetHours" class="bg-white/20 text-white font-semibold py-2 px-6 rounded-lg hover:bg-white/30 transition-all">
                            🔄 Zurücksetzen
                        </button>
                    </div>
                </div>

                <!-- Text Editing Panel -->
                <div id="textPanel" class="bg-white/5 rounded-xl p-6 mb-6 design-panel">
                    <h3 class="text-xl font-semibold text-white mb-4">📝 Alle Texte bearbeiten</h3>
                    
                    <div class="space-y-6">
                        <!-- Main Title -->
                        <div class="bg-white/5 rounded-lg p-4">
                            <h4 class="text-white font-medium mb-3">Haupttitel</h4>
                            <div class="space-y-3">
                                <input type="text" id="editMainTitle" placeholder="Barbershop Elite" class="w-full p-3 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Schriftgröße (rem)</label>
                                        <input type="number" id="mainTitleSize" value="2.5" step="0.1" min="1" max="5" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Schriftart</label>
                                        <select id="mainTitleFont" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                            <option value="Squada One">Squada One</option>
                                            <option value="Oswald">Oswald</option>
                                            <option value="Bebas Neue">Bebas Neue</option>
                                            <option value="Anton">Anton</option>
                                            <option value="Inter">Inter</option>
                                            <option value="Poppins">Poppins</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Subtitle -->
                        <div class="bg-white/5 rounded-lg p-4">
                            <h4 class="text-white font-medium mb-3">Untertitel</h4>
                            <div class="space-y-3">
                                <input type="text" id="editSubtitle" placeholder="Professionelle Herrenfriseur-Services" class="w-full p-3 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Schriftgröße (rem)</label>
                                        <input type="number" id="subtitleSize" value="1.125" step="0.1" min="0.5" max="3" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Schriftart</label>
                                        <select id="subtitleFont" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                            <option value="Inter">Inter</option>
                                            <option value="Poppins">Poppins</option>
                                            <option value="Roboto">Roboto</option>
                                            <option value="Open Sans">Open Sans</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Booking Form Title -->
                        <div class="bg-white/5 rounded-lg p-4">
                            <h4 class="text-white font-medium mb-3">Buchungsformular Titel</h4>
                            <div class="space-y-3">
                                <input type="text" id="editBookingTitle" placeholder="🗓️ Termin buchen" class="w-full p-3 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Schriftgröße (rem)</label>
                                        <input type="number" id="bookingTitleSize" value="1.5" step="0.1" min="0.5" max="3" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Schriftart</label>
                                        <select id="bookingTitleFont" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                            <option value="Inter">Inter</option>
                                            <option value="Poppins">Poppins</option>
                                            <option value="Squada One">Squada One</option>
                                            <option value="Oswald">Oswald</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Button Text -->
                        <div class="bg-white/5 rounded-lg p-4">
                            <h4 class="text-white font-medium mb-3">Button-Text</h4>
                            <div class="space-y-3">
                                <input type="text" id="editButtonText" placeholder="Termin buchen" class="w-full p-3 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Schriftgröße (rem)</label>
                                        <input type="number" id="buttonTextSize" value="1" step="0.1" min="0.5" max="2" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Schriftart</label>
                                        <select id="buttonTextFont" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                            <option value="Inter">Inter</option>
                                            <option value="Poppins">Poppins</option>
                                            <option value="Roboto">Roboto</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Labels -->
                        <div class="bg-white/5 rounded-lg p-4">
                            <h4 class="text-white font-medium mb-3">Formularlabels</h4>
                            <div class="space-y-3">
                                <div class="grid grid-cols-2 gap-3">
                                    <input type="text" id="editServiceLabel" placeholder="Service wählen" class="p-2 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                    <input type="text" id="editDateLabel" placeholder="Datum & Uhrzeit" class="p-2 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <input type="text" id="editNamePlaceholder" placeholder="Ihr Name" class="p-2 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                    <input type="text" id="editPhonePlaceholder" placeholder="Telefonnummer" class="p-2 rounded bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Label-Schriftgröße (rem)</label>
                                        <input type="number" id="labelSize" value="1" step="0.1" min="0.5" max="2" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-white/70 text-sm mb-1">Label-Schriftart</label>
                                        <select id="labelFont" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                                            <option value="Inter">Inter</option>
                                            <option value="Poppins">Poppins</option>
                                            <option value="Roboto">Roboto</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 flex gap-4">
                        <button id="saveTexts" class="bg-white text-purple-600 font-semibold py-2 px-6 rounded-lg hover:bg-white/90 transition-all">
                            💾 Texte speichern
                        </button>
                        <button id="resetTexts" class="bg-white/20 text-white font-semibold py-2 px-6 rounded-lg hover:bg-white/30 transition-all">
                            🔄 Zurücksetzen
                        </button>
                        <button id="previewTexts" class="bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-blue-700 transition-all">
                            👁️ Vorschau
                        </button>
                    </div>
                </div>

                <!-- WhatsApp Panel -->
                <div id="whatsappPanel" class="bg-white/5 rounded-xl p-6 mb-6 design-panel">
                    <h3 class="text-xl font-semibold text-white mb-4">📱 WhatsApp Einstellungen</h3>
                    
                    <div class="space-y-6">
                        <!-- Owner WhatsApp -->
                        <div>
                            <label class="block text-white font-medium mb-3">Inhaber WhatsApp-Nummer</label>
                            <input type="tel" id="ownerWhatsApp" placeholder="+49123456789" class="w-full p-3 rounded-lg bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none">
                            <p class="text-white/60 text-sm mt-2">Diese Nummer erhält Benachrichtigungen bei neuen Buchungen</p>
                        </div>

                        <!-- Auto Notification -->
                        <div class="bg-white/5 rounded-lg p-4">
                            <label class="flex items-center text-white font-medium">
                                <input type="checkbox" id="autoNotifyOwner" class="mr-3 w-4 h-4">
                                Automatische Benachrichtigung aktivieren
                            </label>
                            <p class="text-white/60 text-sm mt-2 ml-7">Bei jeder neuen Buchung wird automatisch eine WhatsApp-Nachricht an den Inhaber gesendet</p>
                        </div>

                        <!-- Test Message -->
                        <div class="bg-white/5 rounded-lg p-4">
                            <h4 class="text-white font-medium mb-3">Test-Nachricht senden</h4>
                            <p class="text-white/60 text-sm mb-3">Teste die WhatsApp-Benachrichtigung mit einer Beispiel-Nachricht</p>
                            <button id="testWhatsApp" class="whatsapp-btn px-4 py-2 rounded-lg font-medium transition-all">
                                📱 Test-Nachricht senden
                            </button>
                        </div>

                        <!-- Message Templates -->
                        <div class="bg-white/5 rounded-lg p-4">
                            <h4 class="text-white font-medium mb-3">Nachrichten-Vorlagen</h4>
                            
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-white/70 text-sm mb-2">Kundenbestätigung</label>
                                    <textarea id="customerTemplate" rows="4" class="w-full p-3 rounded-lg bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none resize-none" placeholder="✅ Buchungsbestätigung

Hallo {name}!

Ihr Termin wurde erfolgreich gebucht:
📅 {date} um {time}
✂️ {service}
💰 {price}€

Wir freuen uns auf Ihren Besuch!

{businessName}"></textarea>
                                </div>

                                <div>
                                    <label class="block text-white/70 text-sm mb-2">Inhaber-Benachrichtigung</label>
                                    <textarea id="ownerTemplate" rows="4" class="w-full p-3 rounded-lg bg-white/10 text-white placeholder-white/50 border border-white/20 focus:border-white/50 focus:outline-none resize-none" placeholder="🔔 Neue Buchung!

Kunde: {name}
📞 {phone}
📅 {date} um {time}
✂️ {service}
💰 {price}€

{businessName} - Admin"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 flex gap-4">
                        <button id="saveWhatsApp" class="bg-white text-purple-600 font-semibold py-2 px-6 rounded-lg hover:bg-white/90 transition-all">
                            💾 WhatsApp-Einstellungen speichern
                        </button>
                        <button id="resetWhatsApp" class="bg-white/20 text-white font-semibold py-2 px-6 rounded-lg hover:bg-white/30 transition-all">
                            🔄 Zurücksetzen
                        </button>
                    </div>
                </div>
                
                <!-- Bookings List -->
                <div class="mb-6">
                    <h3 class="text-white font-medium mb-4">Heutige Termine</h3>
                    <div id="bookingsList" class="space-y-3">
                        <!-- Bookings will be displayed here -->
                    </div>
                </div>

                <!-- Statistics -->
                <div class="grid md:grid-cols-3 gap-4">
                    <div class="bg-white/10 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-white" id="todayBookings">0</div>
                        <div class="text-white/70 text-sm">Heute</div>
                    </div>
                    <div class="bg-white/10 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-white" id="todayRevenue">0€</div>
                        <div class="text-white/70 text-sm">Umsatz</div>
                    </div>
                    <div class="bg-white/10 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-white" id="totalBookings">0</div>
                        <div class="text-white/70 text-sm">Gesamt</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // App State
        let selectedService = null;
        let selectedDate = null;
        let selectedTime = null;
        let bookings = JSON.parse(localStorage.getItem('barbershop_bookings')) || [];
        let services = JSON.parse(localStorage.getItem('barbershop_services')) || [];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            loadDesignSettings();
        });

        function initializeApp() {
            loadServices();
            setupServiceSelection();
            setupDateSelection();
            setupAdminPanel();
            setupDesignPanel();
            setupServiceManagement();
            setupWorkingHoursPanel();
            setupTextEditingPanel();
            setupWhatsAppPanel();
            updateAdminStats();
            setMinDate();
            updateCategoryDropdowns();
            
            // Load saved text settings on startup
            const savedTextSettings = localStorage.getItem('barbershop_textSettings');
            if (savedTextSettings) {
                applyTextSettings(JSON.parse(savedTextSettings));
            }
        }

        function updateCategoryDropdowns() {
            // Update category dropdown for new services
            const newServiceCategorySelect = document.getElementById('newServiceCategory');
            if (newServiceCategorySelect) {
                // Keep existing options and add new categories
                const currentOptions = Array.from(newServiceCategorySelect.options).map(opt => opt.value);
                
                services.forEach(service => {
                    if (service.type === 'category' && !currentOptions.includes(service.id.toString())) {
                        const option = document.createElement('option');
                        option.value = service.id;
                        option.textContent = `${service.emoji} ${service.name}`;
                        newServiceCategorySelect.appendChild(option);
                    }
                });
            }

            // Update category dropdown for subcategory creation
            const selectCategoryForSub = document.getElementById('selectCategoryForSub');
            if (selectCategoryForSub) {
                selectCategoryForSub.innerHTML = '<option value="">Kategorie wählen</option>';
                
                services.forEach(service => {
                    if (service.type === 'category') {
                        const option = document.createElement('option');
                        option.value = service.id;
                        option.textContent = `${service.emoji} ${service.name}`;
                        selectCategoryForSub.appendChild(option);
                    }
                });
            }
        }

        function setMinDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('bookingDate').min = today;
        }

        let currentServicePath = [];
        let serviceNavigationStack = [];

        function loadServices() {
            const servicesList = document.getElementById('servicesList');
            servicesList.innerHTML = '';
            
            // Add navigation breadcrumb if we're in a subcategory
            if (currentServicePath.length > 0) {
                const breadcrumb = document.createElement('div');
                breadcrumb.className = 'mb-4 flex items-center gap-2 text-white/70 text-sm';
                breadcrumb.innerHTML = `
                    <button onclick="goBackInServices()" class="bg-white/10 hover:bg-white/20 px-3 py-1 rounded transition-all">
                        ← Zurück
                    </button>
                    <span>${currentServicePath.join(' > ')}</span>
                `;
                servicesList.appendChild(breadcrumb);
            }
            
            const currentServices = getCurrentServices();
            
            currentServices.forEach(service => {
                const serviceElement = document.createElement('div');
                serviceElement.className = 'service-option bg-white/10 rounded-lg p-4 cursor-pointer hover:bg-white/20 transition-all';
                
                if (service.type === 'category') {
                    // Category - shows subcategories
                    serviceElement.dataset.serviceId = service.id;
                    
                    // Calculate price range for category
                    const priceRange = getCategoryPriceRange(service);
                    
                    serviceElement.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-white font-medium">${service.emoji} ${service.name}</h3>
                                <p class="text-white/70 text-sm">Kategorie wählen →</p>
                            </div>
                            <div class="text-right">
                                <p class="text-white font-bold">${priceRange}</p>
                                <div class="text-white/50">
                                    <span class="text-2xl">→</span>
                                </div>
                            </div>
                        </div>
                    `;
                    serviceElement.addEventListener('click', () => navigateToCategory(service));
                } else if (service.type === 'subcategory') {
                    // Subcategory - shows final options
                    serviceElement.dataset.serviceId = service.id;
                    serviceElement.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-white font-medium">📋 ${service.name}</h3>
                                <p class="text-white/70 text-sm">Optionen anzeigen →</p>
                            </div>
                            <div class="text-white/50">
                                <span class="text-2xl">→</span>
                            </div>
                        </div>
                    `;
                    serviceElement.addEventListener('click', () => navigateToSubcategory(service));
                } else {
                    // Final service option or simple service
                    serviceElement.dataset.serviceId = service.id;
                    serviceElement.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-white font-medium">${service.emoji || '✂️'} ${service.name}</h3>
                                <p class="text-white/70 text-sm">${service.description}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-white font-bold">${service.price}€</p>
                                <p class="text-white/70 text-sm">${service.duration} Min</p>
                            </div>
                        </div>
                    `;
                    serviceElement.addEventListener('click', () => selectFinalService(service));
                }
                
                servicesList.appendChild(serviceElement);
            });
        }

        function getCurrentServices() {
            if (currentServicePath.length === 0) {
                // Show main categories and simple services
                return services;
            } else if (currentServicePath.length === 1) {
                // Show subcategories of selected category
                const category = services.find(s => s.name === currentServicePath[0]);
                return category ? category.subcategories : [];
            } else if (currentServicePath.length === 2) {
                // Show final options of selected subcategory
                const category = services.find(s => s.name === currentServicePath[0]);
                if (category && category.subcategories) {
                    const subcategory = category.subcategories.find(s => s.name === currentServicePath[1]);
                    return subcategory ? subcategory.options : [];
                }
            }
            return [];
        }

        function getCategoryPriceRange(category) {
            if (!category.subcategories || category.subcategories.length === 0) {
                return 'Preis auf Anfrage';
            }

            let minPrice = Infinity;
            let maxPrice = -Infinity;

            category.subcategories.forEach(subcategory => {
                if (subcategory.options && subcategory.options.length > 0) {
                    subcategory.options.forEach(option => {
                        if (option.price < minPrice) minPrice = option.price;
                        if (option.price > maxPrice) maxPrice = option.price;
                    });
                }
            });

            if (minPrice === Infinity || maxPrice === -Infinity) {
                return 'Preis auf Anfrage';
            }

            if (minPrice === maxPrice) {
                return `${minPrice}€`;
            } else {
                return `${minPrice}€ - ${maxPrice}€`;
            }
        }

        function navigateToCategory(category) {
            serviceNavigationStack.push([...currentServicePath]);
            currentServicePath = [category.name];
            loadServices();
        }

        function navigateToSubcategory(subcategory) {
            serviceNavigationStack.push([...currentServicePath]);
            currentServicePath.push(subcategory.name);
            loadServices();
        }

        function selectFinalService(service) {
            // Remove previous selection
            document.querySelectorAll('.service-option').forEach(opt => opt.classList.remove('ring-2', 'ring-white'));
            
            // Add selection to clicked option
            event.target.closest('.service-option').classList.add('ring-2', 'ring-white');
            
            selectedService = {
                id: service.id,
                name: service.name,
                price: service.price,
                duration: service.duration,
                emoji: service.emoji || '✂️',
                fullPath: currentServicePath.length > 0 ? currentServicePath.join(' > ') + ' > ' + service.name : service.name
            };
            
            updateBookingSummary();
            checkBookingComplete();
        }

        function goBackInServices() {
            if (serviceNavigationStack.length > 0) {
                currentServicePath = serviceNavigationStack.pop();
            } else {
                currentServicePath = [];
            }
            
            // Clear selection when navigating back
            selectedService = null;
            updateBookingSummary();
            checkBookingComplete();
            
            loadServices();
        }

        function loadAdminServices() {
            const serviceEditingSections = document.getElementById('serviceEditingSections');
            serviceEditingSections.innerHTML = '';
            
            // Add info about the category system
            const infoSection = document.createElement('div');
            infoSection.className = 'bg-green-500/20 rounded-lg p-4 mb-4';
            infoSection.innerHTML = `
                <h4 class="text-white font-medium mb-2">🚀 Service-Management</h4>
                <p class="text-white/80 text-sm mb-2">
                    Erstellen Sie Ihre eigenen Service-Kategorien:
                </p>
                <ul class="text-white/70 text-sm space-y-1 ml-4">
                    <li>• <strong>Einfache Services:</strong> Direkt buchbare Services</li>
                    <li>• <strong>Kategorien:</strong> Organisieren Sie Services in Gruppen</li>
                    <li>• <strong>Drag & Drop:</strong> Verschieben Sie Services zwischen Kategorien</li>
                    <li>• <strong>Neue Kategorien:</strong> Ziehen Sie Services in die "Neue Kategorie" Zone</li>
                </ul>
                <p class="text-white/60 text-xs mt-2">
                    Beginnen Sie mit dem Hinzufügen Ihrer ersten Services!
                </p>
            `;
            serviceEditingSections.appendChild(infoSection);
            
            // Show all final services (flattened view for admin)
            const allFinalServices = getAllFinalServices();
            
            allFinalServices.forEach(service => {
                const serviceSection = document.createElement('div');
                serviceSection.className = 'bg-white/5 rounded-lg p-4';
                serviceSection.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-white font-medium flex items-center gap-2">
                            <span class="text-xl">${service.emoji || '✂️'}</span>
                            ${service.fullPath || service.name}
                        </h4>
                        <div class="text-white/60 text-xs">
                            ID: ${service.id}
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <!-- Service Name -->
                        <div>
                            <label class="block text-white/70 text-sm mb-1">Service Name</label>
                            <input type="text" id="serviceName_${service.id}" value="${service.name}" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                        </div>
                        
                        <!-- Service Description -->
                        <div>
                            <label class="block text-white/70 text-sm mb-1">Beschreibung</label>
                            <input type="text" id="serviceDescription_${service.id}" value="${service.description || ''}" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                        </div>
                        
                        <!-- Price and Duration -->
                        <div class="grid grid-cols-3 gap-3">
                            <div>
                                <label class="block text-white/70 text-sm mb-1">Preis (€)</label>
                                <input type="number" id="servicePrice_${service.id}" value="${service.price}" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-white/70 text-sm mb-1">Dauer (Min)</label>
                                <input type="number" id="serviceDuration_${service.id}" value="${service.duration}" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-white/70 text-sm mb-1">Emoji</label>
                                <input type="text" id="serviceEmoji_${service.id}" value="${service.emoji || '✂️'}" class="w-full p-2 rounded bg-white/10 text-white border border-white/20 focus:border-white/50 focus:outline-none">
                            </div>
                        </div>
                        
                        <!-- Apply Button -->
                        <div class="mt-3">
                            <button onclick="applyServiceChanges(${service.id})" class="bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700 transition-all">
                                ✨ Sofort anwenden
                            </button>
                        </div>
                    </div>
                `;
                serviceEditingSections.appendChild(serviceSection);
            });
        }

        function getAllFinalServices() {
            const finalServices = [];
            
            services.forEach(service => {
                if (service.type === 'simple') {
                    // Simple service - add directly
                    finalServices.push({
                        ...service,
                        fullPath: service.name
                    });
                } else if (service.type === 'category' && service.subcategories) {
                    // Category with subcategories
                    service.subcategories.forEach(subcategory => {
                        if (subcategory.options) {
                            subcategory.options.forEach(option => {
                                finalServices.push({
                                    ...option,
                                    fullPath: `${service.name} > ${subcategory.name} > ${option.name}`
                                });
                            });
                        }
                    });
                }
            });
            
            return finalServices;
        }

        function setupServiceSelection() {
            // Service selection is now handled directly in loadServices()
            // No additional setup needed as each service type has its own click handler
        }

        function setupDateSelection() {
            const dateInput = document.getElementById('bookingDate');
            dateInput.addEventListener('change', function() {
                selectedDate = this.value;
                generateTimeSlots();
                updateBookingSummary();
                checkBookingComplete();
            });
        }

        function generateTimeSlots() {
            const timeSlotsContainer = document.getElementById('timeSlots');
            timeSlotsContainer.innerHTML = '';
            
            if (!selectedDate) return;
            
            // Get day of week (0 = Sunday, 1 = Monday, etc.)
            const selectedDateObj = new Date(selectedDate);
            const dayOfWeek = selectedDateObj.getDay();
            
            // Check if this day is enabled
            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const dayId = 'day' + dayNames[dayOfWeek];
            const isDayEnabled = localStorage.getItem(`barbershop_${dayId}`) !== 'false';
            
            if (!isDayEnabled) {
                timeSlotsContainer.innerHTML = '<p class="text-white/70 text-center col-span-3">An diesem Tag geschlossen</p>';
                return;
            }
            
            // Get working hours settings
            const openTime = localStorage.getItem('barbershop_openTime') || '09:00';
            const closeTime = localStorage.getItem('barbershop_closeTime') || '18:00';
            const breakStart = localStorage.getItem('barbershop_breakStart') || '12:00';
            const breakEnd = localStorage.getItem('barbershop_breakEnd') || '13:00';
            const interval = parseInt(localStorage.getItem('barbershop_timeInterval') || '30');
            const customSlots = JSON.parse(localStorage.getItem('barbershop_customSlots') || '[]');
            
            // Generate time slots based on settings
            const times = generateAvailableTimes(openTime, closeTime, breakStart, breakEnd, interval, customSlots);
            
            if (times.length === 0) {
                timeSlotsContainer.innerHTML = '<p class="text-white/70 text-center col-span-3">Keine verfügbaren Zeiten</p>';
                return;
            }
            
            times.forEach(time => {
                const isBooked = bookings.some(booking => 
                    booking.date === selectedDate && booking.time === time
                );
                
                const timeSlot = document.createElement('button');
                timeSlot.className = `p-2 rounded text-sm transition-all ${
                    isBooked 
                        ? 'bg-red-500/20 text-red-300 cursor-not-allowed' 
                        : 'bg-white/10 text-white hover:bg-white/20'
                }`;
                timeSlot.textContent = time;
                timeSlot.disabled = isBooked;
                
                if (!isBooked) {
                    timeSlot.addEventListener('click', function() {
                        // Remove previous selection
                        document.querySelectorAll('#timeSlots button').forEach(btn => {
                            btn.classList.remove('ring-2', 'ring-white');
                        });
                        
                        // Add selection
                        this.classList.add('ring-2', 'ring-white');
                        selectedTime = time;
                        updateBookingSummary();
                        checkBookingComplete();
                    });
                }
                
                timeSlotsContainer.appendChild(timeSlot);
            });
        }

        function generateAvailableTimes(openTime, closeTime, breakStart, breakEnd, interval, customSlots) {
            const times = [];
            
            // Convert time strings to minutes
            function timeToMinutes(timeStr) {
                const [hours, minutes] = timeStr.split(':').map(Number);
                return hours * 60 + minutes;
            }
            
            // Convert minutes to time string
            function minutesToTime(minutes) {
                const hours = Math.floor(minutes / 60);
                const mins = minutes % 60;
                return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;
            }
            
            const openMinutes = timeToMinutes(openTime);
            const closeMinutes = timeToMinutes(closeTime);
            const breakStartMinutes = timeToMinutes(breakStart);
            const breakEndMinutes = timeToMinutes(breakEnd);
            
            // Generate regular intervals
            for (let minutes = openMinutes; minutes < closeMinutes; minutes += interval) {
                // Skip break time
                if (minutes >= breakStartMinutes && minutes < breakEndMinutes) {
                    continue;
                }
                times.push(minutesToTime(minutes));
            }
            
            // Add custom slots
            customSlots.forEach(slot => {
                const slotMinutes = timeToMinutes(slot);
                if (slotMinutes >= openMinutes && slotMinutes < closeMinutes && 
                    !(slotMinutes >= breakStartMinutes && slotMinutes < breakEndMinutes)) {
                    if (!times.includes(slot)) {
                        times.push(slot);
                    }
                }
            });
            
            // Sort times
            times.sort();
            
            return times;
        }

        function updateBookingSummary() {
            const summary = document.getElementById('bookingSummary');
            const content = document.getElementById('summaryContent');
            
            if (selectedService && selectedDate && selectedTime) {
                summary.classList.remove('hidden');
                content.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <p><strong>${selectedService.fullPath || selectedService.name}</strong></p>
                            <p>${selectedDate} um ${selectedTime}</p>
                            <p>Dauer: ${selectedService.duration} Minuten</p>
                        </div>
                        <div class="text-right">
                            <p class="text-xl font-bold">${selectedService.price}€</p>
                        </div>
                    </div>
                `;
            } else {
                summary.classList.add('hidden');
            }
        }

        function checkBookingComplete() {
            const bookButton = document.getElementById('bookButton');
            const name = document.getElementById('customerName').value;
            const phone = document.getElementById('customerPhone').value;
            
            if (selectedService && selectedDate && selectedTime && name && phone) {
                bookButton.disabled = false;
            } else {
                bookButton.disabled = true;
            }
        }

        // Book button event
        document.getElementById('bookButton').addEventListener('click', function() {
            const name = document.getElementById('customerName').value;
            const phone = document.getElementById('customerPhone').value;
            
            if (!name || !phone) {
                alert('Bitte füllen Sie alle Felder aus.');
                return;
            }
            
            const booking = {
                id: Date.now(),
                service: selectedService,
                date: selectedDate,
                time: selectedTime,
                customer: { name, phone },
                timestamp: new Date().toISOString()
            };
            
            bookings.push(booking);
            localStorage.setItem('barbershop_bookings', JSON.stringify(bookings));
            
            // Send automatic notifications
            sendBookingNotifications(booking);
            
            alert(`✅ Termin erfolgreich gebucht!\n\n${selectedService.name}\n${selectedDate} um ${selectedTime}\n\nWir freuen uns auf Ihren Besuch!`);
            
            // Reset form
            resetForm();
            updateAdminStats();
            if (!document.getElementById('adminPanel').classList.contains('hidden')) {
                displayBookings();
            }
        });

        function resetForm() {
            selectedService = null;
            selectedDate = null;
            selectedTime = null;
            
            document.querySelectorAll('.service-option').forEach(opt => opt.classList.remove('ring-2', 'ring-white'));
            document.getElementById('bookingDate').value = '';
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('timeSlots').innerHTML = '';
            document.getElementById('bookingSummary').classList.add('hidden');
            document.getElementById('bookButton').disabled = true;
        }

        // Admin Panel with Password Protection
        function setupAdminPanel() {
            document.getElementById('adminToggle').addEventListener('click', function() {
                const adminPanel = document.getElementById('adminPanel');
                if (adminPanel.classList.contains('hidden')) {
                    // Check if already authenticated in this session
                    if (sessionStorage.getItem('admin_authenticated') === 'true') {
                        adminPanel.classList.remove('hidden');
                        displayBookings();
                        return;
                    }
                    
                    // Prompt for password
                    const password = prompt('🔒 Admin-Passwort eingeben:');
                    if (password === 'admin123') {
                        sessionStorage.setItem('admin_authenticated', 'true');
                        adminPanel.classList.remove('hidden');
                        displayBookings();
                        alert('✅ Erfolgreich angemeldet!');
                    } else if (password !== null) {
                        alert('❌ Falsches Passwort!');
                    }
                } else {
                    adminPanel.classList.add('hidden');
                }
            });

            // Logout functionality
            document.getElementById('logoutButton').addEventListener('click', function() {
                sessionStorage.removeItem('admin_authenticated');
                document.getElementById('adminPanel').classList.add('hidden');
                alert('👋 Erfolgreich abgemeldet!');
            });
        }

        function displayBookings() {
            const bookingsList = document.getElementById('bookingsList');
            const today = new Date().toISOString().split('T')[0];
            const todayBookings = bookings.filter(booking => booking.date === today);
            
            if (todayBookings.length === 0) {
                bookingsList.innerHTML = '<p class="text-white/70">Keine Termine für heute</p>';
                return;
            }
            
            bookingsList.innerHTML = todayBookings
                .sort((a, b) => a.time.localeCompare(b.time))
                .map(booking => `
                    <div class="booking-card bg-white/10 rounded-lg p-4">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="text-white font-medium">${booking.customer.name}</h4>
                                <p class="text-white/70 text-sm">${booking.service.name}</p>
                                <p class="text-white/70 text-sm">📞 ${booking.customer.phone}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-white font-bold">${booking.time}</p>
                                <p class="text-white/70 text-sm">${booking.service.price}€</p>
                                <div class="mt-2 space-x-2">
                                    <button onclick="sendWhatsApp('${booking.customer.phone}', '${booking.customer.name}', '${booking.service.name}', '${booking.date}', '${booking.time}')" class="whatsapp-btn text-xs px-2 py-1 rounded">
                                        📱 WhatsApp
                                    </button>
                                    <button onclick="cancelBooking(${booking.id})" class="text-red-400 hover:text-red-300 text-xs px-2 py-1 rounded bg-red-500/20">
                                        ❌ Stornieren
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
        }

        function sendWhatsApp(phone, name, service, date, time) {
            // Clean phone number (remove spaces, dashes, etc.)
            const cleanPhone = phone.replace(/\D/g, '');
            
            // Format message
            const businessName = localStorage.getItem('barbershop_name') || 'Barbershop Elite';
            const message = `Hallo ${name}! 👋

Erinnerung an Ihren Termin:
📅 ${date} um ${time}
✂️ ${service}

Wir freuen uns auf Ihren Besuch!

Ihr ${businessName} Team`;
            
            // Create WhatsApp URL
            const whatsappUrl = `https://wa.me/${cleanPhone}?text=${encodeURIComponent(message)}`;
            
            // Open WhatsApp
            window.open(whatsappUrl, '_blank');
        }

        function sendBookingNotifications(booking) {
            const ownerPhone = localStorage.getItem('barbershop_owner_whatsapp');
            const autoNotify = localStorage.getItem('barbershop_auto_notify') === 'true';
            const businessName = localStorage.getItem('barbershop_name') || 'Barbershop Elite';
            
            // Send confirmation to customer
            sendCustomerConfirmation(booking);
            
            // Send notification to owner if enabled
            if (autoNotify && ownerPhone) {
                sendOwnerNotification(booking, ownerPhone);
            }
        }

        function sendCustomerConfirmation(booking) {
            const cleanPhone = booking.customer.phone.replace(/\D/g, '');
            const businessName = localStorage.getItem('barbershop_name') || 'Barbershop Elite';
            
            // Use custom template if available
            let template = localStorage.getItem('barbershop_customer_template');
            if (!template) {
                template = `✅ Buchungsbestätigung

Hallo {name}!

Ihr Termin wurde erfolgreich gebucht:
📅 {date} um {time}
✂️ {service}
💰 {price}€

Wir freuen uns auf Ihren Besuch!

{businessName}`;
            }

            // Replace placeholders
            const message = template
                .replace(/{name}/g, booking.customer.name)
                .replace(/{date}/g, booking.date)
                .replace(/{time}/g, booking.time)
                .replace(/{service}/g, booking.service.name)
                .replace(/{price}/g, booking.service.price)
                .replace(/{businessName}/g, businessName);
            
            const whatsappUrl = `https://wa.me/${cleanPhone}?text=${encodeURIComponent(message)}`;
            
            // Auto-open WhatsApp for customer confirmation
            setTimeout(() => {
                window.open(whatsappUrl, '_blank');
            }, 1000);
        }

        function sendOwnerNotification(booking, ownerPhone) {
            const cleanOwnerPhone = ownerPhone.replace(/\D/g, '');
            const businessName = localStorage.getItem('barbershop_name') || 'Barbershop Elite';
            
            // Use custom template if available
            let template = localStorage.getItem('barbershop_owner_template');
            if (!template) {
                template = `🔔 Neue Buchung!

Kunde: {name}
📞 {phone}
📅 {date} um {time}
✂️ {service}
💰 {price}€

{businessName} - Admin`;
            }

            // Replace placeholders
            const message = template
                .replace(/{name}/g, booking.customer.name)
                .replace(/{phone}/g, booking.customer.phone)
                .replace(/{date}/g, booking.date)
                .replace(/{time}/g, booking.time)
                .replace(/{service}/g, booking.service.name)
                .replace(/{price}/g, booking.service.price)
                .replace(/{businessName}/g, businessName);
            
            const whatsappUrl = `https://wa.me/${cleanOwnerPhone}?text=${encodeURIComponent(message)}`;
            
            // Auto-open WhatsApp for owner notification
            setTimeout(() => {
                window.open(whatsappUrl, '_blank');
            }, 2000);
        }

        function cancelBooking(bookingId) {
            if (confirm('Termin wirklich stornieren?')) {
                bookings = bookings.filter(booking => booking.id !== bookingId);
                localStorage.setItem('barbershop_bookings', JSON.stringify(bookings));
                displayBookings();
                updateAdminStats();
                generateTimeSlots(); // Refresh available slots
            }
        }

        function updateAdminStats() {
            const today = new Date().toISOString().split('T')[0];
            const todayBookings = bookings.filter(booking => booking.date === today);
            const todayRevenue = todayBookings.reduce((sum, booking) => sum + booking.service.price, 0);
            
            document.getElementById('todayBookings').textContent = todayBookings.length;
            document.getElementById('todayRevenue').textContent = todayRevenue + '€';
            document.getElementById('totalBookings').textContent = bookings.length;
        }

        // Service Management Setup
        function setupServiceManagement() {
            document.getElementById('serviceToggle').addEventListener('click', function() {
                const servicePanel = document.getElementById('servicePanel');
                servicePanel.classList.toggle('open');
                if (servicePanel.classList.contains('open')) {
                    loadAdminServices();
                    setupServiceViewToggle();
                }
            });

            // Create new category
            document.getElementById('createCategoryBtn').addEventListener('click', function() {
                const categoryName = document.getElementById('newCategoryName').value;
                const categoryEmoji = document.getElementById('newCategoryEmoji').value || '✂️';

                if (!categoryName) {
                    alert('Bitte Kategorie-Name eingeben!');
                    return;
                }

                const newCategory = {
                    id: Date.now(),
                    name: categoryName,
                    emoji: categoryEmoji,
                    type: 'category',
                    subcategories: []
                };

                services.push(newCategory);
                localStorage.setItem('barbershop_services', JSON.stringify(services));

                // Clear form
                document.getElementById('newCategoryName').value = '';
                document.getElementById('newCategoryEmoji').value = '';

                // Update dropdowns
                updateCategoryDropdowns();
                loadServices();
                loadAdminServices();
                showNotification('✅ Kategorie erstellt!');
            });

            // Create new subcategory
            document.getElementById('createSubcategoryBtn').addEventListener('click', function() {
                const categoryId = parseInt(document.getElementById('selectCategoryForSub').value);
                const subcategoryName = document.getElementById('newSubcategoryName').value;

                if (!categoryId || !subcategoryName) {
                    alert('Bitte Kategorie und Unterkategorie-Name auswählen/eingeben!');
                    return;
                }

                const category = services.find(s => s.id === categoryId);
                if (!category) {
                    alert('Kategorie nicht gefunden!');
                    return;
                }

                const newSubcategory = {
                    id: Date.now(),
                    name: subcategoryName,
                    type: 'subcategory',
                    options: []
                };

                if (!category.subcategories) {
                    category.subcategories = [];
                }
                category.subcategories.push(newSubcategory);

                localStorage.setItem('barbershop_services', JSON.stringify(services));

                // Clear form
                document.getElementById('selectCategoryForSub').value = '';
                document.getElementById('newSubcategoryName').value = '';

                // Update dropdowns
                updateCategoryDropdowns();
                loadServices();
                loadAdminServices();
                showNotification('✅ Unterkategorie hinzugefügt!');
            });

            // Category selection change handler
            document.getElementById('newServiceCategory').addEventListener('change', function() {
                const selectedCategory = this.value;
                const subcategorySelection = document.getElementById('subcategorySelection');
                const subcategorySelect = document.getElementById('newServiceSubcategory');

                if (selectedCategory && selectedCategory !== 'simple') {
                    const categoryId = parseInt(selectedCategory);
                    const category = services.find(s => s.id === categoryId);
                    
                    if (category && category.subcategories && category.subcategories.length > 0) {
                        // Show subcategory selection
                        subcategorySelection.style.display = 'grid';
                        subcategorySelect.innerHTML = '<option value="">Unterkategorie wählen</option>';
                        
                        category.subcategories.forEach(sub => {
                            const option = document.createElement('option');
                            option.value = sub.id;
                            option.textContent = sub.name;
                            subcategorySelect.appendChild(option);
                        });
                    } else {
                        subcategorySelection.style.display = 'none';
                    }
                } else {
                    subcategorySelection.style.display = 'none';
                }
            });

            document.getElementById('addServiceBtn').addEventListener('click', function() {
                const name = document.getElementById('newServiceName').value;
                const description = document.getElementById('newServiceDescription').value;
                const price = parseInt(document.getElementById('newServicePrice').value);
                const duration = parseInt(document.getElementById('newServiceDuration').value);
                const emoji = document.getElementById('newServiceEmoji').value || '⭐';
                const categoryId = document.getElementById('newServiceCategory').value;
                const subcategoryId = document.getElementById('newServiceSubcategory').value;

                if (!name || !description || !price || !duration) {
                    alert('Bitte alle Felder ausfüllen!');
                    return;
                }

                const newService = {
                    id: Date.now(),
                    name,
                    description,
                    price,
                    duration,
                    emoji
                };

                // Add service to appropriate location
                if (categoryId && categoryId !== 'simple') {
                    const categoryIdNum = parseInt(categoryId);
                    const category = services.find(s => s.id === categoryIdNum);
                    
                    if (category && subcategoryId) {
                        // Add to specific subcategory
                        const subcategoryIdNum = parseInt(subcategoryId);
                        const subcategory = category.subcategories.find(s => s.id === subcategoryIdNum);
                        
                        if (subcategory) {
                            if (!subcategory.options) subcategory.options = [];
                            subcategory.options.push(newService);
                        }
                    } else if (category) {
                        // Create default subcategory if none exists
                        if (!category.subcategories) category.subcategories = [];
                        if (category.subcategories.length === 0) {
                            category.subcategories.push({
                                id: Date.now() + 1,
                                name: 'Standard',
                                type: 'subcategory',
                                options: []
                            });
                        }
                        category.subcategories[0].options.push(newService);
                    }
                } else {
                    // Add as simple service
                    newService.type = 'simple';
                    services.push(newService);
                }

                localStorage.setItem('barbershop_services', JSON.stringify(services));
                
                // Clear form
                document.getElementById('newServiceName').value = '';
                document.getElementById('newServiceDescription').value = '';
                document.getElementById('newServicePrice').value = '';
                document.getElementById('newServiceDuration').value = '';
                document.getElementById('newServiceEmoji').value = '';
                document.getElementById('newServiceCategory').value = '';
                document.getElementById('newServiceSubcategory').value = '';
                document.getElementById('subcategorySelection').style.display = 'none';

                loadServices();
                loadAdminServices();
                showNotification('✅ Service hinzugefügt!');
            });

            // Save all services button
            document.getElementById('saveAllServices').addEventListener('click', function() {
                services.forEach(service => {
                    applyServiceChanges(service.id);
                });
                setTimeout(() => {
                    showNotification('💾 Alle Services gespeichert!');
                }, 500);
            });

            // Preview all services button
            document.getElementById('previewAllServices').addEventListener('click', function() {
                services.forEach(service => {
                    applyServiceChanges(service.id);
                });
                setTimeout(() => {
                    showNotification('👁️ Alle Service-Änderungen angewendet!');
                }, 500);
            });

            // Reset all services button
            document.getElementById('resetAllServices').addEventListener('click', function() {
                if (confirm('Wirklich alle Services löschen? Diese Aktion kann nicht rückgängig gemacht werden!')) {
                    services = [];
                    localStorage.setItem('barbershop_services', JSON.stringify(services));
                    loadServices();
                    loadAdminServices();
                    showNotification('🔄 Alle Services gelöscht!');
                }
            });
        }

        // Apply changes to individual service
        function applyServiceChanges(serviceId) {
            const name = document.getElementById(`serviceName_${serviceId}`).value;
            const description = document.getElementById(`serviceDescription_${serviceId}`).value;
            const price = parseInt(document.getElementById(`servicePrice_${serviceId}`).value);
            const duration = parseInt(document.getElementById(`serviceDuration_${serviceId}`).value);
            const emoji = document.getElementById(`serviceEmoji_${serviceId}`).value;

            if (!name || !price || !duration || !emoji) {
                alert('Bitte alle Pflichtfelder ausfüllen!');
                return;
            }

            // Find and update the service in the nested structure
            let updated = false;
            
            services.forEach(service => {
                if (service.type === 'simple' && service.id === serviceId) {
                    // Update simple service
                    service.name = name;
                    service.description = description;
                    service.price = price;
                    service.duration = duration;
                    service.emoji = emoji;
                    updated = true;
                } else if (service.type === 'category' && service.subcategories) {
                    // Update service in category
                    service.subcategories.forEach(subcategory => {
                        if (subcategory.options) {
                            subcategory.options.forEach(option => {
                                if (option.id === serviceId) {
                                    option.name = name;
                                    option.description = description;
                                    option.price = price;
                                    option.duration = duration;
                                    option.emoji = emoji;
                                    updated = true;
                                }
                            });
                        }
                    });
                }
            });

            if (updated) {
                // Save to localStorage
                localStorage.setItem('barbershop_services', JSON.stringify(services));

                // Reload services display
                loadServices();
                loadAdminServices();

                showNotification(`✨ ${name} aktualisiert!`);
            } else {
                alert('Service nicht gefunden!');
            }
        }

        // Working Hours Panel Setup
        function setupWorkingHoursPanel() {
            document.getElementById('hoursToggle').addEventListener('click', function() {
                const hoursPanel = document.getElementById('hoursPanel');
                hoursPanel.classList.toggle('open');
                if (hoursPanel.classList.contains('open')) {
                    loadWorkingHoursSettings();
                }
            });

            // Save working hours
            document.getElementById('saveHours').addEventListener('click', function() {
                // Save day settings
                const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
                days.forEach(day => {
                    const checkbox = document.getElementById('day' + day);
                    localStorage.setItem(`barbershop_day${day}`, checkbox.checked);
                });

                // Save time settings
                localStorage.setItem('barbershop_openTime', document.getElementById('openTime').value);
                localStorage.setItem('barbershop_closeTime', document.getElementById('closeTime').value);
                localStorage.setItem('barbershop_breakStart', document.getElementById('breakStart').value);
                localStorage.setItem('barbershop_breakEnd', document.getElementById('breakEnd').value);
                localStorage.setItem('barbershop_timeInterval', document.getElementById('timeInterval').value);

                alert('✅ Arbeitszeiten gespeichert!');
                
                // Refresh time slots if date is selected
                if (selectedDate) {
                    generateTimeSlots();
                }
            });

            // Reset working hours
            document.getElementById('resetHours').addEventListener('click', function() {
                if (confirm('Arbeitszeiten wirklich zurücksetzen?')) {
                    const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
                    days.forEach(day => {
                        localStorage.removeItem(`barbershop_day${day}`);
                    });
                    
                    localStorage.removeItem('barbershop_openTime');
                    localStorage.removeItem('barbershop_closeTime');
                    localStorage.removeItem('barbershop_breakStart');
                    localStorage.removeItem('barbershop_breakEnd');
                    localStorage.removeItem('barbershop_timeInterval');
                    localStorage.removeItem('barbershop_customSlots');
                    
                    loadWorkingHoursSettings();
                    alert('✅ Arbeitszeiten zurückgesetzt!');
                }
            });

            // Add custom time slot
            document.getElementById('addTimeSlot').addEventListener('click', function() {
                const timeSlot = document.getElementById('customTimeSlot').value;
                if (!timeSlot) {
                    alert('Bitte eine Zeit eingeben!');
                    return;
                }

                let customSlots = JSON.parse(localStorage.getItem('barbershop_customSlots') || '[]');
                if (!customSlots.includes(timeSlot)) {
                    customSlots.push(timeSlot);
                    customSlots.sort();
                    localStorage.setItem('barbershop_customSlots', JSON.stringify(customSlots));
                    displayCustomTimeSlots();
                    document.getElementById('customTimeSlot').value = '';
                    
                    // Refresh time slots if date is selected
                    if (selectedDate) {
                        generateTimeSlots();
                    }
                }
            });
        }

        function loadWorkingHoursSettings() {
            // Load day settings
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            days.forEach(day => {
                const checkbox = document.getElementById('day' + day);
                const saved = localStorage.getItem(`barbershop_day${day}`);
                if (saved !== null) {
                    checkbox.checked = saved === 'true';
                } else {
                    // Default: Monday-Friday enabled, Saturday-Sunday disabled
                    checkbox.checked = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'].includes(day);
                }
            });

            // Load time settings
            document.getElementById('openTime').value = localStorage.getItem('barbershop_openTime') || '09:00';
            document.getElementById('closeTime').value = localStorage.getItem('barbershop_closeTime') || '18:00';
            document.getElementById('breakStart').value = localStorage.getItem('barbershop_breakStart') || '12:00';
            document.getElementById('breakEnd').value = localStorage.getItem('barbershop_breakEnd') || '13:00';
            document.getElementById('timeInterval').value = localStorage.getItem('barbershop_timeInterval') || '30';

            displayCustomTimeSlots();
        }

        function displayCustomTimeSlots() {
            const container = document.getElementById('customTimeSlots');
            const customSlots = JSON.parse(localStorage.getItem('barbershop_customSlots') || '[]');
            
            container.innerHTML = customSlots.map(slot => `
                <span class="bg-white/10 text-white px-3 py-1 rounded-full text-sm flex items-center gap-2">
                    ${slot}
                    <button onclick="removeCustomTimeSlot('${slot}')" class="text-red-400 hover:text-red-300">
                        ✕
                    </button>
                </span>
            `).join('');
        }

        function removeCustomTimeSlot(slot) {
            let customSlots = JSON.parse(localStorage.getItem('barbershop_customSlots') || '[]');
            customSlots = customSlots.filter(s => s !== slot);
            localStorage.setItem('barbershop_customSlots', JSON.stringify(customSlots));
            displayCustomTimeSlots();
            
            // Refresh time slots if date is selected
            if (selectedDate) {
                generateTimeSlots();
            }
        }

        // Text Editing Panel Setup
        function setupTextEditingPanel() {
            document.getElementById('textToggle').addEventListener('click', function() {
                const textPanel = document.getElementById('textPanel');
                textPanel.classList.toggle('open');
                if (textPanel.classList.contains('open')) {
                    loadTextSettings();
                }
            });

            // Save texts
            document.getElementById('saveTexts').addEventListener('click', function() {
                // Save all text settings
                const textSettings = {
                    mainTitle: document.getElementById('editMainTitle').value,
                    mainTitleSize: document.getElementById('mainTitleSize').value,
                    mainTitleFont: document.getElementById('mainTitleFont').value,
                    subtitle: document.getElementById('editSubtitle').value,
                    subtitleSize: document.getElementById('subtitleSize').value,
                    subtitleFont: document.getElementById('subtitleFont').value,
                    bookingTitle: document.getElementById('editBookingTitle').value,
                    bookingTitleSize: document.getElementById('bookingTitleSize').value,
                    bookingTitleFont: document.getElementById('bookingTitleFont').value,
                    buttonText: document.getElementById('editButtonText').value,
                    buttonTextSize: document.getElementById('buttonTextSize').value,
                    buttonTextFont: document.getElementById('buttonTextFont').value,
                    serviceLabel: document.getElementById('editServiceLabel').value,
                    dateLabel: document.getElementById('editDateLabel').value,
                    namePlaceholder: document.getElementById('editNamePlaceholder').value,
                    phonePlaceholder: document.getElementById('editPhonePlaceholder').value,
                    labelSize: document.getElementById('labelSize').value,
                    labelFont: document.getElementById('labelFont').value
                };

                localStorage.setItem('barbershop_textSettings', JSON.stringify(textSettings));
                applyTextSettings(textSettings);
                alert('✅ Texte gespeichert!');
            });

            // Preview texts
            document.getElementById('previewTexts').addEventListener('click', function() {
                const textSettings = {
                    mainTitle: document.getElementById('editMainTitle').value || 'Barbershop Elite',
                    mainTitleSize: document.getElementById('mainTitleSize').value,
                    mainTitleFont: document.getElementById('mainTitleFont').value,
                    subtitle: document.getElementById('editSubtitle').value || 'Professionelle Herrenfriseur-Services',
                    subtitleSize: document.getElementById('subtitleSize').value,
                    subtitleFont: document.getElementById('subtitleFont').value,
                    bookingTitle: document.getElementById('editBookingTitle').value || '🗓️ Termin buchen',
                    bookingTitleSize: document.getElementById('bookingTitleSize').value,
                    bookingTitleFont: document.getElementById('bookingTitleFont').value,
                    buttonText: document.getElementById('editButtonText').value || 'Termin buchen',
                    buttonTextSize: document.getElementById('buttonTextSize').value,
                    buttonTextFont: document.getElementById('buttonTextFont').value,
                    serviceLabel: document.getElementById('editServiceLabel').value || 'Service wählen',
                    dateLabel: document.getElementById('editDateLabel').value || 'Datum & Uhrzeit',
                    namePlaceholder: document.getElementById('editNamePlaceholder').value || 'Ihr Name',
                    phonePlaceholder: document.getElementById('editPhonePlaceholder').value || 'Telefonnummer',
                    labelSize: document.getElementById('labelSize').value,
                    labelFont: document.getElementById('labelFont').value
                };

                applyTextSettings(textSettings);
            });

            // Reset texts
            document.getElementById('resetTexts').addEventListener('click', function() {
                if (confirm('Alle Texte wirklich zurücksetzen?')) {
                    localStorage.removeItem('barbershop_textSettings');
                    loadTextSettings();
                    applyDefaultTextSettings();
                    alert('✅ Texte zurückgesetzt!');
                }
            });
        }

        function loadTextSettings() {
            const saved = localStorage.getItem('barbershop_textSettings');
            if (saved) {
                const settings = JSON.parse(saved);
                
                document.getElementById('editMainTitle').value = settings.mainTitle || '';
                document.getElementById('mainTitleSize').value = settings.mainTitleSize || '2.5';
                document.getElementById('mainTitleFont').value = settings.mainTitleFont || 'Squada One';
                document.getElementById('editSubtitle').value = settings.subtitle || '';
                document.getElementById('subtitleSize').value = settings.subtitleSize || '1.125';
                document.getElementById('subtitleFont').value = settings.subtitleFont || 'Inter';
                document.getElementById('editBookingTitle').value = settings.bookingTitle || '';
                document.getElementById('bookingTitleSize').value = settings.bookingTitleSize || '1.5';
                document.getElementById('bookingTitleFont').value = settings.bookingTitleFont || 'Inter';
                document.getElementById('editButtonText').value = settings.buttonText || '';
                document.getElementById('buttonTextSize').value = settings.buttonTextSize || '1';
                document.getElementById('buttonTextFont').value = settings.buttonTextFont || 'Inter';
                document.getElementById('editServiceLabel').value = settings.serviceLabel || '';
                document.getElementById('editDateLabel').value = settings.dateLabel || '';
                document.getElementById('editNamePlaceholder').value = settings.namePlaceholder || '';
                document.getElementById('editPhonePlaceholder').value = settings.phonePlaceholder || '';
                document.getElementById('labelSize').value = settings.labelSize || '1';
                document.getElementById('labelFont').value = settings.labelFont || 'Inter';
            }
        }

        function applyTextSettings(settings) {
            // Apply main title
            if (settings.mainTitle) {
                document.getElementById('businessName').textContent = settings.mainTitle;
                document.getElementById('businessName').style.fontSize = settings.mainTitleSize + 'rem';
                document.getElementById('businessName').style.fontFamily = settings.mainTitleFont;
            }

            // Apply subtitle
            const subtitle = document.querySelector('.text-white\\/80.text-lg');
            if (subtitle && settings.subtitle) {
                subtitle.textContent = settings.subtitle;
                subtitle.style.fontSize = settings.subtitleSize + 'rem';
                subtitle.style.fontFamily = settings.subtitleFont;
            }

            // Apply booking title
            const bookingTitle = document.querySelector('#bookingForm h2');
            if (bookingTitle && settings.bookingTitle) {
                bookingTitle.textContent = settings.bookingTitle;
                bookingTitle.style.fontSize = settings.bookingTitleSize + 'rem';
                bookingTitle.style.fontFamily = settings.bookingTitleFont;
            }

            // Apply button text
            const bookButton = document.getElementById('bookButton');
            if (bookButton && settings.buttonText) {
                bookButton.textContent = settings.buttonText;
                bookButton.style.fontSize = settings.buttonTextSize + 'rem';
                bookButton.style.fontFamily = settings.buttonTextFont;
            }

            // Apply labels
            const labels = document.querySelectorAll('#bookingForm label');
            labels.forEach((label, index) => {
                if (index === 0 && settings.serviceLabel) {
                    label.textContent = settings.serviceLabel;
                } else if (index === 1 && settings.dateLabel) {
                    label.textContent = settings.dateLabel;
                }
                label.style.fontSize = settings.labelSize + 'rem';
                label.style.fontFamily = settings.labelFont;
            });

            // Apply placeholders
            if (settings.namePlaceholder) {
                document.getElementById('customerName').placeholder = settings.namePlaceholder;
            }
            if (settings.phonePlaceholder) {
                document.getElementById('customerPhone').placeholder = settings.phonePlaceholder;
            }
        }

        function applyDefaultTextSettings() {
            document.getElementById('businessName').textContent = 'Barbershop Elite';
            document.getElementById('businessName').style.fontSize = '2.5rem';
            document.getElementById('businessName').style.fontFamily = 'Squada One';
            
            const subtitle = document.querySelector('.text-white\\/80.text-lg');
            if (subtitle) {
                subtitle.textContent = 'Professionelle Herrenfriseur-Services';
                subtitle.style.fontSize = '1.125rem';
                subtitle.style.fontFamily = 'Inter';
            }
            
            const bookingTitle = document.querySelector('#bookingForm h2');
            if (bookingTitle) {
                bookingTitle.textContent = '🗓️ Termin buchen';
                bookingTitle.style.fontSize = '1.5rem';
                bookingTitle.style.fontFamily = 'Inter';
            }
            
            document.getElementById('bookButton').textContent = 'Termin buchen';
            document.getElementById('customerName').placeholder = 'Ihr Name';
            document.getElementById('customerPhone').placeholder = 'Telefonnummer';
        }

        // WhatsApp Panel Setup
        function setupWhatsAppPanel() {
            document.getElementById('whatsappToggle').addEventListener('click', function() {
                const whatsappPanel = document.getElementById('whatsappPanel');
                whatsappPanel.classList.toggle('open');
            });

            // Test WhatsApp functionality
            document.getElementById('testWhatsApp').addEventListener('click', function() {
                const ownerPhone = document.getElementById('ownerWhatsApp').value;
                if (!ownerPhone) {
                    alert('Bitte geben Sie zuerst Ihre WhatsApp-Nummer ein!');
                    return;
                }

                const businessName = localStorage.getItem('barbershop_name') || 'Barbershop Elite';
                const testMessage = `🧪 Test-Nachricht

Hallo! Dies ist eine Test-Nachricht von Ihrem Barbershop-System.

Die WhatsApp-Benachrichtigungen funktionieren korrekt! ✅

${businessName} - Admin System`;

                const cleanPhone = ownerPhone.replace(/\D/g, '');
                const whatsappUrl = `https://wa.me/${cleanPhone}?text=${encodeURIComponent(testMessage)}`;
                window.open(whatsappUrl, '_blank');
            });

            // Save WhatsApp settings
            document.getElementById('saveWhatsApp').addEventListener('click', function() {
                const ownerPhone = document.getElementById('ownerWhatsApp').value;
                const autoNotify = document.getElementById('autoNotifyOwner').checked;
                const customerTemplate = document.getElementById('customerTemplate').value;
                const ownerTemplate = document.getElementById('ownerTemplate').value;

                localStorage.setItem('barbershop_owner_whatsapp', ownerPhone);
                localStorage.setItem('barbershop_auto_notify', autoNotify);
                localStorage.setItem('barbershop_customer_template', customerTemplate);
                localStorage.setItem('barbershop_owner_template', ownerTemplate);

                alert('✅ WhatsApp-Einstellungen gespeichert!');
            });

            // Reset WhatsApp settings
            document.getElementById('resetWhatsApp').addEventListener('click', function() {
                if (confirm('WhatsApp-Einstellungen wirklich zurücksetzen?')) {
                    localStorage.removeItem('barbershop_owner_whatsapp');
                    localStorage.removeItem('barbershop_auto_notify');
                    localStorage.removeItem('barbershop_customer_template');
                    localStorage.removeItem('barbershop_owner_template');
                    
                    document.getElementById('ownerWhatsApp').value = '';
                    document.getElementById('autoNotifyOwner').checked = false;
                    document.getElementById('customerTemplate').value = '';
                    document.getElementById('ownerTemplate').value = '';
                    
                    alert('✅ WhatsApp-Einstellungen zurückgesetzt!');
                }
            });
        }

        function editService(serviceId) {
            const service = services.find(s => s.id === serviceId);
            if (!service) return;

            const newName = prompt('Service Name:', service.name);
            if (newName === null) return;

            const newDescription = prompt('Beschreibung:', service.description);
            if (newDescription === null) return;

            const newPrice = prompt('Preis (€):', service.price);
            if (newPrice === null) return;

            const newDuration = prompt('Dauer (Minuten):', service.duration);
            if (newDuration === null) return;

            const newEmoji = prompt('Emoji:', service.emoji);
            if (newEmoji === null) return;

            service.name = newName;
            service.description = newDescription;
            service.price = parseInt(newPrice);
            service.duration = parseInt(newDuration);
            service.emoji = newEmoji;

            localStorage.setItem('barbershop_services', JSON.stringify(services));
            loadServices();
            loadAdminServices();
            alert('✅ Service aktualisiert!');
        }

        function deleteService(serviceId) {
            if (confirm('Service wirklich löschen?')) {
                services = services.filter(s => s.id !== serviceId);
                localStorage.setItem('barbershop_services', JSON.stringify(services));
                loadServices();
                loadAdminServices();
                alert('✅ Service gelöscht!');
            }
        }

        // Design Panel Setup
        function setupDesignPanel() {
            document.getElementById('designToggle').addEventListener('click', function() {
                const designPanel = document.getElementById('designPanel');
                designPanel.classList.toggle('open');
                if (designPanel.classList.contains('open')) {
                    loadDesignTextSettings();
                }
            });

            // Logo upload
            document.getElementById('logoUpload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 2 * 1024 * 1024) {
                        alert('Datei zu groß! Maximal 2MB erlaubt.');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const logoContainer = document.getElementById('logoContainer');
                        logoContainer.innerHTML = `<img src="${e.target.result}" alt="Logo">`;
                        localStorage.setItem('barbershop_logo', e.target.result);
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Business name
            document.getElementById('businessNameInput').addEventListener('input', function() {
                const name = this.value || 'Barbershop Elite';
                document.getElementById('businessName').textContent = name;
                localStorage.setItem('barbershop_name', name);
            });

            // Individual text element buttons
            document.getElementById('applyMainTitle').addEventListener('click', function() {
                const text = document.getElementById('editMainTitleDesign').value || 'Barbershop Elite';
                const size = document.getElementById('mainTitleSizeDesign').value;
                const font = document.getElementById('mainTitleFontDesign').value;
                
                const element = document.getElementById('businessName');
                element.textContent = text;
                element.style.fontSize = size + 'rem';
                element.style.fontFamily = font;
                
                // Save to localStorage
                localStorage.setItem('barbershop_main_title', text);
                localStorage.setItem('barbershop_main_title_size', size);
                localStorage.setItem('barbershop_main_title_font', font);
                
                showNotification('✨ Haupttitel aktualisiert!');
            });

            document.getElementById('applySubtitle').addEventListener('click', function() {
                const text = document.getElementById('editSubtitleDesign').value || 'Professionelle Herrenfriseur-Services';
                const size = document.getElementById('subtitleSizeDesign').value;
                const font = document.getElementById('subtitleFontDesign').value;
                
                const element = document.querySelector('.text-white\\/80.text-lg');
                if (element) {
                    element.textContent = text;
                    element.style.fontSize = size + 'rem';
                    element.style.fontFamily = font;
                }
                
                localStorage.setItem('barbershop_subtitle', text);
                localStorage.setItem('barbershop_subtitle_size', size);
                localStorage.setItem('barbershop_subtitle_font', font);
                
                showNotification('✨ Untertitel aktualisiert!');
            });

            document.getElementById('applyBookingTitle').addEventListener('click', function() {
                const text = document.getElementById('editBookingTitleDesign').value || '🗓️ Termin buchen';
                const size = document.getElementById('bookingTitleSizeDesign').value;
                const font = document.getElementById('bookingTitleFontDesign').value;
                
                const element = document.querySelector('#bookingForm h2');
                if (element) {
                    element.textContent = text;
                    element.style.fontSize = size + 'rem';
                    element.style.fontFamily = font;
                }
                
                localStorage.setItem('barbershop_booking_title', text);
                localStorage.setItem('barbershop_booking_title_size', size);
                localStorage.setItem('barbershop_booking_title_font', font);
                
                showNotification('✨ Buchungstitel aktualisiert!');
            });

            document.getElementById('applyLabels').addEventListener('click', function() {
                const serviceLabel = document.getElementById('editServiceLabelDesign').value || 'Service wählen';
                const dateLabel = document.getElementById('editDateLabelDesign').value || 'Datum & Uhrzeit';
                const namePlaceholder = document.getElementById('editNamePlaceholderDesign').value || 'Ihr Name';
                const phonePlaceholder = document.getElementById('editPhonePlaceholderDesign').value || 'Telefonnummer';
                const size = document.getElementById('labelSizeDesign').value;
                const font = document.getElementById('labelFontDesign').value;
                
                // Update labels
                const labels = document.querySelectorAll('#bookingForm label');
                if (labels[0]) {
                    labels[0].textContent = serviceLabel;
                    labels[0].style.fontSize = size + 'rem';
                    labels[0].style.fontFamily = font;
                }
                if (labels[1]) {
                    labels[1].textContent = dateLabel;
                    labels[1].style.fontSize = size + 'rem';
                    labels[1].style.fontFamily = font;
                }
                
                // Update placeholders
                document.getElementById('customerName').placeholder = namePlaceholder;
                document.getElementById('customerPhone').placeholder = phonePlaceholder;
                
                // Save to localStorage
                localStorage.setItem('barbershop_service_label', serviceLabel);
                localStorage.setItem('barbershop_date_label', dateLabel);
                localStorage.setItem('barbershop_name_placeholder', namePlaceholder);
                localStorage.setItem('barbershop_phone_placeholder', phonePlaceholder);
                localStorage.setItem('barbershop_label_size', size);
                localStorage.setItem('barbershop_label_font', font);
                
                showNotification('✨ Labels aktualisiert!');
            });

            document.getElementById('applyButton').addEventListener('click', function() {
                const text = document.getElementById('editButtonTextDesign').value || 'Termin buchen';
                const size = document.getElementById('buttonTextSizeDesign').value;
                const font = document.getElementById('buttonTextFontDesign').value;
                
                const element = document.getElementById('bookButton');
                element.textContent = text;
                element.style.fontSize = size + 'rem';
                element.style.fontFamily = font;
                
                localStorage.setItem('barbershop_button_text', text);
                localStorage.setItem('barbershop_button_size', size);
                localStorage.setItem('barbershop_button_font', font);
                
                showNotification('✨ Button aktualisiert!');
            });

            // Preview all changes
            document.getElementById('previewAllChanges').addEventListener('click', function() {
                // Apply all changes at once
                document.getElementById('applyMainTitle').click();
                setTimeout(() => document.getElementById('applySubtitle').click(), 100);
                setTimeout(() => document.getElementById('applyBookingTitle').click(), 200);
                setTimeout(() => document.getElementById('applyLabels').click(), 300);
                setTimeout(() => document.getElementById('applyButton').click(), 400);
                
                setTimeout(() => showNotification('👁️ Alle Änderungen angewendet!'), 500);
            });

            // Custom color inputs
            document.getElementById('primaryColorInput').addEventListener('input', function() {
                const color = this.value;
                if (isValidHexColor(color)) {
                    document.documentElement.style.setProperty('--primary-color', color);
                    document.getElementById('primaryColorPicker').value = color;
                    localStorage.setItem('barbershop_primary_color', color);
                }
            });

            document.getElementById('primaryColorPicker').addEventListener('input', function() {
                const color = this.value;
                document.documentElement.style.setProperty('--primary-color', color);
                document.getElementById('primaryColorInput').value = color;
                localStorage.setItem('barbershop_primary_color', color);
            });

            document.getElementById('secondaryColorInput').addEventListener('input', function() {
                const color = this.value;
                if (isValidHexColor(color)) {
                    document.documentElement.style.setProperty('--secondary-color', color);
                    document.getElementById('secondaryColorPicker').value = color;
                    localStorage.setItem('barbershop_secondary_color', color);
                }
            });

            document.getElementById('secondaryColorPicker').addEventListener('input', function() {
                const color = this.value;
                document.documentElement.style.setProperty('--secondary-color', color);
                document.getElementById('secondaryColorInput').value = color;
                localStorage.setItem('barbershop_secondary_color', color);
            });

            // Save design
            document.getElementById('saveDesign').addEventListener('click', function() {
                // Save all current values
                document.getElementById('applyMainTitle').click();
                setTimeout(() => document.getElementById('applySubtitle').click(), 100);
                setTimeout(() => document.getElementById('applyBookingTitle').click(), 200);
                setTimeout(() => document.getElementById('applyLabels').click(), 300);
                setTimeout(() => document.getElementById('applyButton').click(), 400);
                
                setTimeout(() => {
                    alert('✅ Alle Texte und Design-Einstellungen gespeichert!');
                }, 600);
            });

            // Reset design
            document.getElementById('resetDesign').addEventListener('click', function() {
                if (confirm('Design und alle Texte wirklich zurücksetzen?')) {
                    // Remove all design and text settings
                    const keysToRemove = [
                        'barbershop_logo', 'barbershop_name', 'barbershop_primary_color', 'barbershop_secondary_color',
                        'barbershop_main_title', 'barbershop_main_title_size', 'barbershop_main_title_font',
                        'barbershop_subtitle', 'barbershop_subtitle_size', 'barbershop_subtitle_font',
                        'barbershop_booking_title', 'barbershop_booking_title_size', 'barbershop_booking_title_font',
                        'barbershop_service_label', 'barbershop_date_label', 'barbershop_name_placeholder', 
                        'barbershop_phone_placeholder', 'barbershop_label_size', 'barbershop_label_font',
                        'barbershop_button_text', 'barbershop_button_size', 'barbershop_button_font'
                    ];
                    
                    keysToRemove.forEach(key => localStorage.removeItem(key));
                    location.reload();
                }
            });
        }

        function loadDesignTextSettings() {
            // Load main title settings
            document.getElementById('editMainTitleDesign').value = localStorage.getItem('barbershop_main_title') || '';
            document.getElementById('mainTitleSizeDesign').value = localStorage.getItem('barbershop_main_title_size') || '2.5';
            document.getElementById('mainTitleFontDesign').value = localStorage.getItem('barbershop_main_title_font') || 'Squada One';
            
            // Load subtitle settings
            document.getElementById('editSubtitleDesign').value = localStorage.getItem('barbershop_subtitle') || '';
            document.getElementById('subtitleSizeDesign').value = localStorage.getItem('barbershop_subtitle_size') || '1.125';
            document.getElementById('subtitleFontDesign').value = localStorage.getItem('barbershop_subtitle_font') || 'Inter';
            
            // Load booking title settings
            document.getElementById('editBookingTitleDesign').value = localStorage.getItem('barbershop_booking_title') || '';
            document.getElementById('bookingTitleSizeDesign').value = localStorage.getItem('barbershop_booking_title_size') || '1.5';
            document.getElementById('bookingTitleFontDesign').value = localStorage.getItem('barbershop_booking_title_font') || 'Inter';
            
            // Load label settings
            document.getElementById('editServiceLabelDesign').value = localStorage.getItem('barbershop_service_label') || '';
            document.getElementById('editDateLabelDesign').value = localStorage.getItem('barbershop_date_label') || '';
            document.getElementById('editNamePlaceholderDesign').value = localStorage.getItem('barbershop_name_placeholder') || '';
            document.getElementById('editPhonePlaceholderDesign').value = localStorage.getItem('barbershop_phone_placeholder') || '';
            document.getElementById('labelSizeDesign').value = localStorage.getItem('barbershop_label_size') || '1';
            document.getElementById('labelFontDesign').value = localStorage.getItem('barbershop_label_font') || 'Inter';
            
            // Load button settings
            document.getElementById('editButtonTextDesign').value = localStorage.getItem('barbershop_button_text') || '';
            document.getElementById('buttonTextSizeDesign').value = localStorage.getItem('barbershop_button_size') || '1';
            document.getElementById('buttonTextFontDesign').value = localStorage.getItem('barbershop_button_font') || 'Inter';
        }

        function showNotification(message) {
            // Create a temporary notification
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg z-50 transition-all';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Remove after 2 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 2000);
        }

        function isValidHexColor(hex) {
            return /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(hex);
        }

        function loadDesignSettings() {
            // Load logo
            const savedLogo = localStorage.getItem('barbershop_logo');
            if (savedLogo) {
                document.getElementById('logoContainer').innerHTML = `<img src="${savedLogo}" alt="Logo">`;
            }

            // Load business name
            const savedName = localStorage.getItem('barbershop_name');
            if (savedName) {
                document.getElementById('businessName').textContent = savedName;
                document.getElementById('businessNameInput').value = savedName;
            }

            // Load and apply saved text settings
            const savedMainTitle = localStorage.getItem('barbershop_main_title');
            const savedMainTitleSize = localStorage.getItem('barbershop_main_title_size');
            const savedMainTitleFont = localStorage.getItem('barbershop_main_title_font');
            if (savedMainTitle || savedMainTitleSize || savedMainTitleFont) {
                const element = document.getElementById('businessName');
                if (savedMainTitle) element.textContent = savedMainTitle;
                if (savedMainTitleSize) element.style.fontSize = savedMainTitleSize + 'rem';
                if (savedMainTitleFont) element.style.fontFamily = savedMainTitleFont;
            }

            const savedSubtitle = localStorage.getItem('barbershop_subtitle');
            const savedSubtitleSize = localStorage.getItem('barbershop_subtitle_size');
            const savedSubtitleFont = localStorage.getItem('barbershop_subtitle_font');
            if (savedSubtitle || savedSubtitleSize || savedSubtitleFont) {
                const element = document.querySelector('.text-white\\/80.text-lg');
                if (element) {
                    if (savedSubtitle) element.textContent = savedSubtitle;
                    if (savedSubtitleSize) element.style.fontSize = savedSubtitleSize + 'rem';
                    if (savedSubtitleFont) element.style.fontFamily = savedSubtitleFont;
                }
            }

            const savedBookingTitle = localStorage.getItem('barbershop_booking_title');
            const savedBookingTitleSize = localStorage.getItem('barbershop_booking_title_size');
            const savedBookingTitleFont = localStorage.getItem('barbershop_booking_title_font');
            if (savedBookingTitle || savedBookingTitleSize || savedBookingTitleFont) {
                const element = document.querySelector('#bookingForm h2');
                if (element) {
                    if (savedBookingTitle) element.textContent = savedBookingTitle;
                    if (savedBookingTitleSize) element.style.fontSize = savedBookingTitleSize + 'rem';
                    if (savedBookingTitleFont) element.style.fontFamily = savedBookingTitleFont;
                }
            }

            const savedServiceLabel = localStorage.getItem('barbershop_service_label');
            const savedDateLabel = localStorage.getItem('barbershop_date_label');
            const savedLabelSize = localStorage.getItem('barbershop_label_size');
            const savedLabelFont = localStorage.getItem('barbershop_label_font');
            if (savedServiceLabel || savedDateLabel || savedLabelSize || savedLabelFont) {
                const labels = document.querySelectorAll('#bookingForm label');
                if (labels[0]) {
                    if (savedServiceLabel) labels[0].textContent = savedServiceLabel;
                    if (savedLabelSize) labels[0].style.fontSize = savedLabelSize + 'rem';
                    if (savedLabelFont) labels[0].style.fontFamily = savedLabelFont;
                }
                if (labels[1]) {
                    if (savedDateLabel) labels[1].textContent = savedDateLabel;
                    if (savedLabelSize) labels[1].style.fontSize = savedLabelSize + 'rem';
                    if (savedLabelFont) labels[1].style.fontFamily = savedLabelFont;
                }
            }

            const savedNamePlaceholder = localStorage.getItem('barbershop_name_placeholder');
            const savedPhonePlaceholder = localStorage.getItem('barbershop_phone_placeholder');
            if (savedNamePlaceholder) {
                document.getElementById('customerName').placeholder = savedNamePlaceholder;
            }
            if (savedPhonePlaceholder) {
                document.getElementById('customerPhone').placeholder = savedPhonePlaceholder;
            }

            const savedButtonText = localStorage.getItem('barbershop_button_text');
            const savedButtonSize = localStorage.getItem('barbershop_button_size');
            const savedButtonFont = localStorage.getItem('barbershop_button_font');
            if (savedButtonText || savedButtonSize || savedButtonFont) {
                const element = document.getElementById('bookButton');
                if (savedButtonText) element.textContent = savedButtonText;
                if (savedButtonSize) element.style.fontSize = savedButtonSize + 'rem';
                if (savedButtonFont) element.style.fontFamily = savedButtonFont;
            }

            // Load colors
            const savedPrimary = localStorage.getItem('barbershop_primary_color');
            const savedSecondary = localStorage.getItem('barbershop_secondary_color');
            if (savedPrimary) {
                document.documentElement.style.setProperty('--primary-color', savedPrimary);
                document.getElementById('primaryColorInput').value = savedPrimary;
                document.getElementById('primaryColorPicker').value = savedPrimary;
            }
            if (savedSecondary) {
                document.documentElement.style.setProperty('--secondary-color', savedSecondary);
                document.getElementById('secondaryColorInput').value = savedSecondary;
                document.getElementById('secondaryColorPicker').value = savedSecondary;
            }

            // Load WhatsApp settings
            const savedOwnerWhatsApp = localStorage.getItem('barbershop_owner_whatsapp');
            if (savedOwnerWhatsApp) {
                document.getElementById('ownerWhatsApp').value = savedOwnerWhatsApp;
            }

            const savedAutoNotify = localStorage.getItem('barbershop_auto_notify');
            if (savedAutoNotify === 'true') {
                document.getElementById('autoNotifyOwner').checked = true;
            }

            // Load message templates
            const savedCustomerTemplate = localStorage.getItem('barbershop_customer_template');
            if (savedCustomerTemplate) {
                document.getElementById('customerTemplate').value = savedCustomerTemplate;
            }

            const savedOwnerTemplate = localStorage.getItem('barbershop_owner_template');
            if (savedOwnerTemplate) {
                document.getElementById('ownerTemplate').value = savedOwnerTemplate;
            }
        }

        // Service View Toggle Setup
        function setupServiceViewToggle() {
            document.getElementById('viewEditMode').addEventListener('click', function() {
                document.getElementById('editModeContent').classList.remove('hidden');
                document.getElementById('organizeModeContent').classList.add('hidden');
                this.classList.add('bg-blue-600');
                this.classList.remove('bg-gray-600');
                document.getElementById('viewOrganizeMode').classList.remove('bg-purple-600');
                document.getElementById('viewOrganizeMode').classList.add('bg-gray-600');
            });

            document.getElementById('viewOrganizeMode').addEventListener('click', function() {
                document.getElementById('editModeContent').classList.add('hidden');
                document.getElementById('organizeModeContent').classList.remove('hidden');
                this.classList.add('bg-purple-600');
                this.classList.remove('bg-gray-600');
                document.getElementById('viewEditMode').classList.remove('bg-blue-600');
                document.getElementById('viewEditMode').classList.add('bg-gray-600');
                loadDragDropInterface();
            });
        }

        function addServiceToCategory(service, categoryPath) {
            const [mainCategory, subCategory] = categoryPath.split('-');
            
            // Find or create main category
            let category = services.find(s => s.name.toLowerCase().includes(mainCategory));
            if (!category) {
                category = {
                    id: Date.now(),
                    name: mainCategory.charAt(0).toUpperCase() + mainCategory.slice(1),
                    emoji: '✂️',
                    type: 'category',
                    subcategories: []
                };
                services.push(category);
            }

            // Find or create subcategory
            let subcategory = category.subcategories.find(s => s.name.toLowerCase().includes(subCategory));
            if (!subcategory) {
                subcategory = {
                    id: Date.now() + 1,
                    name: subCategory.charAt(0).toUpperCase() + subCategory.slice(1),
                    type: 'subcategory',
                    options: []
                };
                category.subcategories.push(subcategory);
            }

            // Add service to subcategory
            subcategory.options.push(service);
        }

        function loadDragDropInterface() {
            const container = document.getElementById('dragDropServiceContainer');
            container.innerHTML = '';

            // Create categories with drag & drop
            services.forEach(service => {
                if (service.type === 'category') {
                    const categoryDiv = createCategoryDragDropSection(service);
                    container.appendChild(categoryDiv);
                } else if (service.type === 'simple') {
                    // Create simple services section
                    if (!container.querySelector('#simpleServicesSection')) {
                        const simpleSection = createSimpleServicesDragDropSection();
                        container.appendChild(simpleSection);
                    }
                    const simpleSection = container.querySelector('#simpleServicesSection .drop-zone');
                    const serviceElement = createDraggableServiceElement(service);
                    simpleSection.appendChild(serviceElement);
                }
            });

            // Add empty drop zone for creating new categories
            const newCategoryZone = document.createElement('div');
            newCategoryZone.className = 'drop-zone';
            newCategoryZone.innerHTML = `
                <div class="text-center text-white/60">
                    <p class="text-lg mb-2">➕ Neue Kategorie erstellen</p>
                    <p class="text-sm">Service hierher ziehen um neue Kategorie zu erstellen</p>
                </div>
            `;
            newCategoryZone.addEventListener('dragover', handleDragOver);
            newCategoryZone.addEventListener('drop', handleDropNewCategory);
            container.appendChild(newCategoryZone);
        }

        function createCategoryDragDropSection(category) {
            const categoryDiv = document.createElement('div');
            categoryDiv.className = 'category-container';
            categoryDiv.innerHTML = `
                <h4 class="text-white font-medium mb-3 flex items-center gap-2">
                    <span class="text-xl">${category.emoji}</span>
                    ${category.name}
                </h4>
            `;

            if (category.subcategories) {
                category.subcategories.forEach(subcategory => {
                    const subcategoryDiv = document.createElement('div');
                    subcategoryDiv.className = 'bg-white/5 rounded-lg p-3 mb-3';
                    subcategoryDiv.innerHTML = `
                        <h5 class="text-white/80 font-medium mb-2">📋 ${subcategory.name}</h5>
                        <div class="drop-zone" data-category="${category.id}" data-subcategory="${subcategory.id}">
                            <div class="text-white/40 text-sm text-center mb-2">Services hierher ziehen</div>
                        </div>
                    `;

                    const dropZone = subcategoryDiv.querySelector('.drop-zone');
                    dropZone.addEventListener('dragover', handleDragOver);
                    dropZone.addEventListener('drop', handleDrop);

                    if (subcategory.options) {
                        subcategory.options.forEach(option => {
                            const serviceElement = createDraggableServiceElement(option);
                            dropZone.appendChild(serviceElement);
                        });
                    }

                    categoryDiv.appendChild(subcategoryDiv);
                });
            }

            return categoryDiv;
        }

        function createSimpleServicesDragDropSection() {
            const simpleSection = document.createElement('div');
            simpleSection.id = 'simpleServicesSection';
            simpleSection.className = 'category-container';
            simpleSection.innerHTML = `
                <h4 class="text-white font-medium mb-3 flex items-center gap-2">
                    <span class="text-xl">⭐</span>
                    Einfache Services
                </h4>
                <div class="drop-zone" data-simple="true">
                    <div class="text-white/40 text-sm text-center mb-2">Einfache Services hierher ziehen</div>
                </div>
            `;

            const dropZone = simpleSection.querySelector('.drop-zone');
            dropZone.addEventListener('dragover', handleDragOver);
            dropZone.addEventListener('drop', handleDrop);

            return simpleSection;
        }

        function createDraggableServiceElement(service) {
            const serviceDiv = document.createElement('div');
            serviceDiv.className = 'service-item draggable-service';
            serviceDiv.draggable = true;
            serviceDiv.dataset.serviceId = service.id;
            serviceDiv.innerHTML = `
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-2">
                        <span class="text-lg cursor-move">⋮⋮</span>
                        <span class="text-lg">${service.emoji || '✂️'}</span>
                        <div>
                            <div class="text-white font-medium">${service.name}</div>
                            <div class="text-white/60 text-xs">${service.description}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-white font-bold">${service.price}€</div>
                        <div class="text-white/60 text-xs">${service.duration} Min</div>
                    </div>
                </div>
            `;

            serviceDiv.addEventListener('dragstart', handleDragStart);
            serviceDiv.addEventListener('dragend', handleDragEnd);

            return serviceDiv;
        }

        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.dataset.serviceId);
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            const serviceId = parseInt(e.dataTransfer.getData('text/plain'));
            const dropZone = e.currentTarget;
            
            // Find and remove service from current location
            const service = findAndRemoveService(serviceId);
            if (!service) return;

            // Add service to new location
            if (dropZone.dataset.simple === 'true') {
                // Move to simple services
                service.type = 'simple';
                services.push(service);
            } else {
                // Move to category/subcategory
                const categoryId = parseInt(dropZone.dataset.category);
                const subcategoryId = parseInt(dropZone.dataset.subcategory);
                
                const category = services.find(s => s.id === categoryId);
                if (category && category.subcategories) {
                    const subcategory = category.subcategories.find(s => s.id === subcategoryId);
                    if (subcategory) {
                        if (!subcategory.options) subcategory.options = [];
                        subcategory.options.push(service);
                    }
                }
            }

            // Save and reload
            localStorage.setItem('barbershop_services', JSON.stringify(services));
            loadServices();
            loadDragDropInterface();
            showNotification('✅ Service verschoben!');
        }

        function handleDropNewCategory(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            const serviceId = parseInt(e.dataTransfer.getData('text/plain'));
            const service = findAndRemoveService(serviceId);
            if (!service) return;

            const categoryName = prompt('Name für neue Kategorie:');
            if (!categoryName) {
                // Put service back if cancelled
                services.push(service);
                return;
            }

            const subcategoryName = prompt('Name für Unterkategorie:');
            if (!subcategoryName) {
                services.push(service);
                return;
            }

            // Create new category structure
            const newCategory = {
                id: Date.now(),
                name: categoryName,
                emoji: '✂️',
                type: 'category',
                subcategories: [{
                    id: Date.now() + 1,
                    name: subcategoryName,
                    type: 'subcategory',
                    options: [service]
                }]
            };

            services.push(newCategory);
            localStorage.setItem('barbershop_services', JSON.stringify(services));
            loadServices();
            loadDragDropInterface();
            showNotification('✅ Neue Kategorie erstellt!');
        }

        function findAndRemoveService(serviceId) {
            // Check simple services
            let serviceIndex = services.findIndex(s => s.id === serviceId && s.type === 'simple');
            if (serviceIndex !== -1) {
                return services.splice(serviceIndex, 1)[0];
            }

            // Check category services
            for (let category of services) {
                if (category.type === 'category' && category.subcategories) {
                    for (let subcategory of category.subcategories) {
                        if (subcategory.options) {
                            const optionIndex = subcategory.options.findIndex(o => o.id === serviceId);
                            if (optionIndex !== -1) {
                                return subcategory.options.splice(optionIndex, 1)[0];
                            }
                        }
                    }
                }
            }

            return null;
        }

        // Customer info validation
        document.getElementById('customerName').addEventListener('input', checkBookingComplete);
        document.getElementById('customerPhone').addEventListener('input', checkBookingComplete);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97af2986219fbe8b',t:'MTc1NzE3NDI0Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
